<!DOCTYPE html><html lang="en" dir="ltr" data-theme="dark" data-has-toc data-has-sidebar class="astro-bguv2lll"> <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Writing hooks for Gemini CLI | Gemini CLI</title><link rel="canonical" href="https://geminicli.com/docs/hooks/writing-hooks/"/><link rel="sitemap" href="/sitemap-index.xml"/><link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="true"/><link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=block" rel="stylesheet"/><link href="https://fonts.googleapis.com/css2?family=Google+Sans+Text:wght@400;500&display=block" rel="stylesheet"/><link href="https://fonts.googleapis.com/css2?family=Google+Sans+Mono:wght@400;500&display=block" rel="stylesheet"/><link href="https://fonts.googleapis.com/css2?family=Google+Symbols&display=block" rel="stylesheet"/><link rel="icon" href="/favicon.ico" sizes="32x32"/><script async src="https://www.googletagmanager.com/gtag/js?id=G-66QE907DJT"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());
  gtag("config", "G-66QE907DJT");</script><link rel="shortcut icon" href="/icon.png" type="image/png"/><meta name="generator" content="Astro v5.14.8"/><meta name="generator" content="Starlight v0.36.1"/><meta property="og:title" content="Writing hooks for Gemini CLI"/><meta property="og:type" content="article"/><meta property="og:url" content="https://geminicli.com/docs/hooks/writing-hooks/"/><meta property="og:locale" content="en"/><meta property="og:description"/><meta property="og:site_name" content="Gemini CLI"/><meta name="twitter:card" content="summary_large_image"/><meta property="og:image" content="https://geminicli.com/assets/social-poster.png"/><meta name="twitter:image" content="https://geminicli.com/assets/social-poster.png"/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg><svg aria-hidden="true" class="dark astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg><svg aria-hidden="true" class="auto astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg></template><link rel="stylesheet" href="/_astro/print.DNXP8c50.css" media="print"><link rel="stylesheet" href="/_astro/debugz.BJBL9UVz.css"><script type="module" src="/_astro/page.CqwDW6Ek.js"></script></head> <body class="astro-bguv2lll"> <a href="#_top" class="astro-7q3lir66">Skip to content</a>  <div class="announcement-banner astro-yriad4ts"> <b class="astro-yriad4ts">Gemini 3 Flash is now available</b>. Speed no longer has to mean compromising
  quality. <a href="https://developers.googleblog.com/gemini-3-flash-is-now-available-in-gemini-cli/" class="astro-yriad4ts">Read the announcement</a> </div> <div class="page sl-flex astro-yriad4ts"> <header class="header astro-yriad4ts"><div id="page-header" class="header astro-3ef6ksr2"> <div class="title-wrapper sl-flex items-center astro-3ef6ksr2"> <div class="links-and-menu astro-3ef6ksr2" role="button" aria-label="Open navigation menu"> <a href="/" class="site-title sl-flex astro-m46x6ez3">  <img class="astro-m46x6ez3" alt="Gemini CLI Icon" src="/_astro/icon.Bo4M5sF3.png" width="1645" height="1645">  <span class="astro-m46x6ez3" translate="no"> Gemini CLI </span> </a>  <div class="nav-items astro-jvd4jwbq"> <a href="/" class="mobile-only astro-jvd4jwbq">Home</a> <div class="extensions-container astro-jvd4jwbq"> <a href="/extensions/" class="dark:text-white text-black no-underline extensions-link astro-jvd4jwbq">Extensions</a> <div class="extensions-menu astro-jvd4jwbq"> <a href="/extensions/" class="mobile-hide astro-jvd4jwbq" class="dark:text-white text-black no-underline extensions-link">Gallery</a> <a href="/extensions/about" class="dark:text-white text-black no-underline astro-jvd4jwbq">About Extensions</a> </div> </div> <a href="/docs/" class="dark:text-white text-black no-underline is-active astro-jvd4jwbq">Docs</a> <a href="/docs/changelogs/" class="dark:text-white text-black no-underline astro-jvd4jwbq">Changelog</a> </div>  </div> </div> <div class="sl-flex justify-end print:hidden search astro-3ef6ksr2"> <site-search class="astro-3ef6ksr2 astro-v37mnknz" data-translations="{&#34;placeholder&#34;:&#34;Search&#34;}"> <button data-open-modal disabled aria-label="Search" aria-keyshortcuts="Control+K" class="astro-v37mnknz"> <svg aria-hidden="true" class="astro-v37mnknz astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg> <span class="sl-hidden md:sl-block astro-v37mnknz" aria-hidden="true">Search</span> <kbd class="sl-hidden md:sl-flex astro-v37mnknz" style="display: none;"> <kbd class="astro-v37mnknz">Ctrl</kbd><kbd class="astro-v37mnknz">K</kbd> </kbd> </button> <dialog style="padding:0" aria-label="Search" class="astro-v37mnknz"> <div class="dialog-frame sl-flex astro-v37mnknz">  <button data-close-modal class="sl-flex md:sl-hidden astro-v37mnknz"> Cancel </button> <div class="search-container astro-v37mnknz"> <div id="starlight__search" class="astro-v37mnknz"></div> </div> </div> </dialog> </site-search>  <script>
	(() => {
		const openBtn = document.querySelector('button[data-open-modal]');
		const shortcut = openBtn?.querySelector('kbd');
		if (!openBtn || !(shortcut instanceof HTMLElement)) return;
		const platformKey = shortcut.querySelector('kbd');
		if (platformKey && /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)) {
			platformKey.textContent = 'âŒ˜';
			openBtn.setAttribute('aria-keyshortcuts', 'Meta+K');
		}
		shortcut.style.display = '';
	})();
</script> <script type="module" src="/_astro/Search.astro_astro_type_script_index_0_lang.cjYDvRdi.js"></script>   </div> <div class="sl-hidden md:sl-flex print:hidden right-group astro-3ef6ksr2"> <div class="sl-flex social-icons astro-3ef6ksr2"> <a href="https://github.com/google-gemini/gemini-cli" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg></a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> <select autocomplete="off" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected class="astro-4yphtoen">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script> <script type="module">const r="starlight-theme",o=e=>e==="auto"||e==="dark"||e==="light"?e:"auto",c=()=>o(typeof localStorage<"u"&&localStorage.getItem(r));function n(e){typeof localStorage<"u"&&localStorage.setItem(r,e==="light"||e==="dark"?e:"")}const l=()=>matchMedia("(prefers-color-scheme: light)").matches?"light":"dark";function t(e){StarlightThemeProvider.updatePickers(e),document.documentElement.dataset.theme=e==="auto"?l():e,n(e)}matchMedia("(prefers-color-scheme: light)").addEventListener("change",()=>{c()==="auto"&&t("auto")});class s extends HTMLElement{constructor(){super(),t(c()),this.querySelector("select")?.addEventListener("change",a=>{a.currentTarget instanceof HTMLSelectElement&&t(o(a.currentTarget.value))})}}customElements.define("starlight-theme-select",s);</script> <script type="module">class s extends HTMLElement{constructor(){super();const e=this.querySelector("select");e&&(e.addEventListener("change",t=>{t.currentTarget instanceof HTMLSelectElement&&(window.location.pathname=t.currentTarget.value)}),window.addEventListener("pageshow",t=>{if(!t.persisted)return;const n=e.querySelector("option[selected]")?.index;n!==e.selectedIndex&&(e.selectedIndex=n??0)}))}}customElements.define("starlight-lang-select",s);</script> </div> </div> <script type="module">const e=document.querySelector("[role=button].links-and-menu");e?.addEventListener("click",t=>{const{matches:s}=window.matchMedia("(max-width: 640px)");if(!s)return;if(e.querySelector(".nav-items")?.contains(t.target)){e.classList.remove("is-active");return}t.preventDefault(),e.classList.toggle("is-active")});</script>  </header> <nav class="sidebar print:hidden astro-yriad4ts" aria-label="Main"> <starlight-menu-button class="print:hidden astro-jif73yzw"> <button aria-expanded="false" aria-label="Menu" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-jif73yzw"> <svg aria-hidden="true" class="open-menu astro-jif73yzw astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg> <svg aria-hidden="true" class="close-menu astro-jif73yzw astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="m13.41 12 6.3-6.29a1.004 1.004 0 1 0-1.42-1.42L12 10.59l-6.29-6.3a1.004 1.004 0 0 0-1.42 1.42l6.3 6.29-6.3 6.29a1 1 0 0 0 0 1.42.998.998 0 0 0 1.42 0l6.29-6.3 6.29 6.3a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.42L13.41 12Z"/></svg> </button> </starlight-menu-button> <script type="module">class s extends HTMLElement{constructor(){super(),this.btn=this.querySelector("button"),this.btn.addEventListener("click",()=>this.toggleExpanded());const t=this.closest("nav");t&&t.addEventListener("keyup",e=>this.closeOnEscape(e))}setExpanded(t){this.setAttribute("aria-expanded",String(t)),document.body.toggleAttribute("data-mobile-menu-expanded",t)}toggleExpanded(){this.setExpanded(this.getAttribute("aria-expanded")!=="true")}closeOnEscape(t){t.code==="Escape"&&(this.setExpanded(!1),this.btn.focus())}}customElements.define("starlight-menu-button",s);</script>   <div id="starlight__sidebar" class="sidebar-pane astro-yriad4ts"> <div class="sidebar-content sl-flex astro-yriad4ts"> <sl-sidebar-state-persist data-hash="0rmj47v" class="astro-kku4brbg"> <script aria-hidden="true">
		(() => {
			try {
				if (!matchMedia('(min-width: 50em)').matches) return;
				/** @type {HTMLElement | null} */
				const target = document.querySelector('sl-sidebar-state-persist');
				const state = JSON.parse(sessionStorage.getItem('sl-sidebar-state') || '0');
				if (!target || !state || target.dataset.hash !== state.hash) return;
				window._starlightScrollRestore = state.scroll;
				customElements.define(
					'sl-sidebar-restore',
					class SidebarRestore extends HTMLElement {
						connectedCallback() {
							try {
								const idx = parseInt(this.dataset.index || '');
								const details = this.closest('details');
								if (details && typeof state.open[idx] === 'boolean') details.open = state.open[idx];
							} catch {}
						}
					}
				);
			} catch {}
		})();
	</script>  <ul class="top-level astro-3ii7xxms"> <li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Overview</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="0"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/docs/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Introduction</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/architecture/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Architecture overview</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/contributing/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Contribution guide</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Get started</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="1"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/docs/get-started/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Gemini CLI quickstart</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/get-started/gemini-3/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Gemini 3 on Gemini CLI</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/get-started/authentication/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Authentication</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/get-started/configuration/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Configuration</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/get-started/installation/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Installation</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/get-started/examples/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Examples</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">CLI</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="2"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/docs/cli/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Introduction</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/cli/commands/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Commands</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/cli/checkpointing/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Checkpointing</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/cli/custom-commands/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Custom commands</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/cli/enterprise/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Enterprise</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/cli/headless/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Headless mode</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/cli/keyboard-shortcuts/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Keyboard shortcuts</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/cli/model/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Model selection</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/cli/sandbox/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Sandbox</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/cli/session-management/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Session Management</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/cli/settings/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Settings</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/cli/telemetry/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Telemetry</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/cli/themes/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Themes</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/cli/token-caching/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Token caching</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/cli/trusted-folders/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Trusted Folders</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/cli/tutorials/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Tutorials</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/cli/uninstall/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Uninstall</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/cli/system-prompt/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">System prompt override</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Core</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="3"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/docs/core/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Introduction</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/core/tools-api/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Tools API</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/core/memport/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Memory Import Processor</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/core/policy-engine/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Policy Engine</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Tools</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="4"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/docs/tools/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Introduction</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/tools/file-system/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">File system</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/tools/shell/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Shell</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/tools/web-fetch/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Web fetch</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/tools/web-search/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Web search</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/tools/memory/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Memory</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/tools/todos/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Todos</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/tools/mcp-server/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">MCP servers</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Extensions</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="5"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/docs/extensions/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Introduction</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/extensions/getting-started-extensions/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Get started with extensions</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/extensions/extension-releasing/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Extension releasing</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Hooks</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="6"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/docs/hooks/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Introduction</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/hooks/writing-hooks/" aria-current="page" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Writing hooks</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/hooks/reference/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Hooks reference</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/hooks/best-practices/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Best practices</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">IDE integration</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="7"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/docs/ide-integration/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Introduction</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/ide-integration/ide-companion-spec/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">IDE companion spec</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Development</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="8"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/docs/npm/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">NPM</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/releases/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Releases</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/integration-tests/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Integration tests</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/issue-and-pr-automation/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Issue and PR automation</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Releases</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="9"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/docs/changelogs/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Release notes</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/changelogs/latest/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Latest release</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/changelogs/preview/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Preview release</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/changelogs/releases/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Changelog</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Support</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="10"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/docs/faq/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">FAQ</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/troubleshooting/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Troubleshooting</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/quota-and-pricing/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Quota and pricing</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/docs/tos-privacy/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Terms of service</span>  </a> </li> </ul>  </details> </li> </ul>   <script aria-hidden="true">
		(() => {
			const scroller = document.getElementById('starlight__sidebar');
			if (!window._starlightScrollRestore || !scroller) return;
			scroller.scrollTop = window._starlightScrollRestore;
			delete window._starlightScrollRestore;
		})();
	</script> </sl-sidebar-state-persist>  <div class="md:sl-hidden"> <div class="mobile-preferences sl-flex astro-wu23bvmt"> <div class="social-icons astro-wu23bvmt"> <a href="https://github.com/google-gemini/gemini-cli" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg></a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> <select autocomplete="off" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected class="astro-4yphtoen">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div>  </div> </div> </div> </nav> <!-- Main grows to push footer down --> <div class="main-frame astro-yriad4ts">   <script type="module">const a=document.getElementById("starlight__sidebar"),n=a?.querySelector("sl-sidebar-state-persist"),o="sl-sidebar-state",i=()=>{let t=[];const e=n?.dataset.hash||"";try{const s=sessionStorage.getItem(o),r=JSON.parse(s||"{}");Array.isArray(r.open)&&r.hash===e&&(t=r.open)}catch{}return{hash:e,open:t,scroll:a?.scrollTop||0}},c=t=>{try{sessionStorage.setItem(o,JSON.stringify(t))}catch{}},d=()=>c(i()),l=(t,e)=>{const s=i();s.open[e]=t,c(s)};n?.addEventListener("click",t=>{if(!(t.target instanceof Element))return;const e=t.target.closest("summary")?.closest("details");if(!e)return;const s=e.querySelector("sl-sidebar-restore"),r=parseInt(s?.dataset.index||"");isNaN(r)||l(!e.open,r)});addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&d()});addEventListener("pageHide",d);</script> <div class="lg:sl-flex astro-67yu43on"> <aside class="right-sidebar-container print:hidden astro-67yu43on"> <div class="right-sidebar astro-67yu43on"> <div class="lg:sl-hidden astro-pb3aqygn"><mobile-starlight-toc data-min-h="2" data-max-h="3" class="astro-doynk5tl"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-doynk5tl"><details id="starlight__mobile-toc" class="astro-doynk5tl"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-doynk5tl"><span class="toggle sl-flex astro-doynk5tl">On this page<svg aria-hidden="true" class="caret astro-doynk5tl astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg></span><span class="display-current astro-doynk5tl"></span></summary><div class="dropdown astro-doynk5tl"><ul class="isMobile astro-g2bywc46" style="--depth: 0;"> <li class="astro-g2bywc46" style="--depth: 0;"> <a href="#_top" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Introduction</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#prerequisites" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Prerequisites</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#quick-start" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Quick start</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#step-1-create-your-hook-script" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Step 1: Create your hook script</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#step-2-configure-the-hook" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Step 2: Configure the hook</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#step-3-test-your-hook" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Step 3: Test your hook</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#practical-examples" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Practical examples</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#security-block-secrets-in-commits" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Security: Block secrets in commits</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#auto-testing-after-code-changes" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Auto-testing after code changes</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#dynamic-context-injection" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Dynamic context injection</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#advanced-features" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Advanced features</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#rag-based-tool-filtering" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">RAG-based tool filtering</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#cross-session-memory" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Cross-session memory</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#hook-chaining" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Hook chaining</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#complete-example-smart-development-workflow-assistant" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Complete example: Smart Development Workflow Assistant</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#architecture" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Architecture</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#installation" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Installation</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#configuration" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Configuration</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#hook-scripts" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Hook scripts</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#example-session" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Example session</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#what-makes-this-example-special" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">What makes this example special</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#cost-efficiency" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Cost efficiency</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#customization" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Customization</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#learn-more" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Learn more</span> </a>  </li> </ul> </div></details></nav></mobile-starlight-toc><script type="module" src="/_astro/MobileTableOfContents.astro_astro_type_script_index_0_lang.C181hMzK.js"></script></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-pb3aqygn"><div class="sl-container astro-pb3aqygn"><starlight-toc data-min-h="2" data-max-h="3"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">On this page</h2><ul class="astro-g2bywc46" style="--depth: 0;"> <li class="astro-g2bywc46" style="--depth: 0;"> <a href="#_top" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Introduction</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#prerequisites" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Prerequisites</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#quick-start" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Quick start</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#step-1-create-your-hook-script" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Step 1: Create your hook script</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#step-2-configure-the-hook" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Step 2: Configure the hook</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#step-3-test-your-hook" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Step 3: Test your hook</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#practical-examples" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Practical examples</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#security-block-secrets-in-commits" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Security: Block secrets in commits</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#auto-testing-after-code-changes" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Auto-testing after code changes</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#dynamic-context-injection" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Dynamic context injection</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#advanced-features" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Advanced features</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#rag-based-tool-filtering" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">RAG-based tool filtering</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#cross-session-memory" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Cross-session memory</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#hook-chaining" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Hook chaining</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#complete-example-smart-development-workflow-assistant" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Complete example: Smart Development Workflow Assistant</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#architecture" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Architecture</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#installation" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Installation</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#configuration" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Configuration</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#hook-scripts" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Hook scripts</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#example-session" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Example session</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#what-makes-this-example-special" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">What makes this example special</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#cost-efficiency" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Cost efficiency</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#customization" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Customization</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#learn-more" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Learn more</span> </a>  </li> </ul> </nav></starlight-toc><script type="module" src="/_astro/TableOfContents.astro_astro_type_script_index_0_lang.CKWWgpjV.js"></script></div></div> </div> </aside> <div class="main-pane astro-67yu43on">  <main data-pagefind-body class="astro-bguv2lll" lang="en" dir="ltr">    <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <div class="flex items-center page-title astro-guvttfii"> <h1 id="_top" class="flex-1 astro-guvttfii"> Writing hooks for Gemini CLI </h1> <div class="mt-4 astro-guvttfii"> <button id="copy-markdown-btn" class="copy-markdown-button astro-guvttfii astro-ym2cbydy" type="button" aria-label="Copy page content as markdown for selected language" title="Copy as Markdown"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="astro-ym2cbydy"> <rect width="14" height="14" x="8" y="8" rx="2" ry="2" class="astro-ym2cbydy"></rect> <path d="m4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" class="astro-ym2cbydy"></path> </svg> <span class="button-text astro-ym2cbydy">Copy as Markdown</span> <span class="success-text astro-ym2cbydy" style="display: none;">Copied!</span> </button>  <script type="module">class i{constructor(){this.init()}init(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.setupEventListeners()):this.setupEventListeners()}setupEventListeners(){const t=document.getElementById("copy-markdown-btn");t&&t.addEventListener("click",()=>this.copyMarkdown())}async copyMarkdown(){const t=document.getElementById("copy-markdown-btn");if(t)try{this.setButtonState(t,"copying");const e=`${window.location.pathname.replace(/\/$/,"")}.md`,o=await fetch(e);if(!o.ok)throw new Error(`Failed to fetch markdown: ${o.status}`);const a=await o.text();await this.copyToClipboard(a),this.setButtonState(t,"success"),setTimeout(()=>{this.setButtonState(t,"default")},2e3)}catch(n){console.error("Failed to copy markdown:",n),this.setButtonState(t,"error"),setTimeout(()=>{this.setButtonState(t,"default")},2e3)}}getCurrentLanguage(){return document.documentElement.getAttribute("data-genkit-lang")||"js"}async copyToClipboard(t){if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(t);else throw new Error("Clipboard API not available.")}setButtonState(t,n){const s=t.querySelector(".button-text"),e=t.querySelector(".success-text");switch(t.classList.remove("copying","success","error"),n){case"copying":t.classList.add("copying"),s&&(s.style.display="none"),e&&(e.textContent="Copying...",e.style.display="inline");break;case"success":t.classList.add("success"),s&&(s.style.display="none"),e&&(e.textContent="Copied!",e.style.display="inline");break;case"error":t.classList.add("error"),s&&(s.style.display="none"),e&&(e.textContent="Error",e.style.display="inline");break;default:s&&(s.style.display="inline"),e&&(e.style.display="none");break}}}new i;</script> </div> </div>  </div> </div>  <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <div class="sl-markdown-content"> <p>This guide will walk you through creating hooks for Gemini CLI, from a simple
logging hook to a comprehensive workflow assistant that demonstrates all hook
events working together.</p>
<div class="sl-heading-wrapper level-h2"><h2 id="prerequisites">Prerequisites</h2><a class="sl-anchor-link" href="#prerequisites"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œPrerequisitesâ€</span></a></div>
<p>Before you start, make sure you have:</p>
<ul>
<li>Gemini CLI installed and configured</li>
<li>Basic understanding of shell scripting or JavaScript/Node.js</li>
<li>Familiarity with JSON for hook input/output</li>
</ul>
<div class="sl-heading-wrapper level-h2"><h2 id="quick-start">Quick start</h2><a class="sl-anchor-link" href="#quick-start"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œQuick startâ€</span></a></div>
<p>Letâ€™s create a simple hook that logs all tool executions to understand the
basics.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="step-1-create-your-hook-script">Step 1: Create your hook script</h3><a class="sl-anchor-link" href="#step-1-create-your-hook-script"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œStep 1: Create your hook scriptâ€</span></a></div>
<p>Create a directory for hooks and a simple logging script:</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.me98n.css"><script type="module" src="/_astro/ec.p1z7b.js"></script><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#BD9CFE;--1:#6F4CDE">mkdir</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">-p</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">.gemini/hooks</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD9CFE;--1:#6F4CDE">cat</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">></span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">.gemini/hooks/log-tools.sh</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">&#x3C;&#x3C;</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">'EOF'</span></div></div><div class="ec-line"><div class="code"><span style="--0:#77D5A3;--1:#007847">#!/usr/bin/env bash</span></div></div><div class="ec-line"><div class="code"><span style="--0:#77D5A3;--1:#007847"># Read hook input from stdin</span></div></div><div class="ec-line"><div class="code"><span style="--0:#77D5A3;--1:#007847">input=$(cat)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#77D5A3;--1:#007847"># Extract tool name</span></div></div><div class="ec-line"><div class="code"><span style="--0:#77D5A3;--1:#007847">tool_name=$(echo "$input" | jq -r '.tool_name')</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#77D5A3;--1:#007847"># Log to file</span></div></div><div class="ec-line"><div class="code"><span style="--0:#77D5A3;--1:#007847">echo "[$(date)] Tool executed: $tool_name" >> .gemini/tool-log.txt</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#77D5A3;--1:#007847"># Return success (exit 0) - output goes to user in transcript mode</span></div></div><div class="ec-line"><div class="code"><span style="--0:#77D5A3;--1:#007847">echo "Logged: $tool_name"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#77D5A3;--1:#007847">EOF</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#BD9CFE;--1:#6F4CDE">chmod</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">+x</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">.gemini/hooks/log-tools.sh</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="mkdir -p .gemini/hookscat > .gemini/hooks/log-tools.sh << &#x27;EOF&#x27;#!/usr/bin/env bash# Read hook input from stdininput=$(cat)# Extract tool nametool_name=$(echo &#x22;$input&#x22; | jq -r &#x27;.tool_name&#x27;)# Log to fileecho &#x22;[$(date)] Tool executed: $tool_name&#x22; >> .gemini/tool-log.txt# Return success (exit 0) - output goes to user in transcript modeecho &#x22;Logged: $tool_name&#x22;EOFchmod +x .gemini/hooks/log-tools.sh"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="step-2-configure-the-hook">Step 2: Configure the hook</h3><a class="sl-anchor-link" href="#step-2-configure-the-hook"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œStep 2: Configure the hookâ€</span></a></div>
<p>Add the hook configuration to <code dir="auto">.gemini/settings.json</code>:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="json"><code><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85CDF1;--1:#00709A">"hooks"</span><span style="--0:#E1DFDF;--1:#292929">: {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85CDF1;--1:#00709A">"AfterTool"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"matcher"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"*"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"hooks"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"name"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"tool-logger"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"type"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"command"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"command"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"$GEMINI_PROJECT_DIR/.gemini/hooks/log-tools.sh"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"description"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"Log all tool executions"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{  &#x22;hooks&#x22;: {    &#x22;AfterTool&#x22;: [      {        &#x22;matcher&#x22;: &#x22;*&#x22;,        &#x22;hooks&#x22;: [          {            &#x22;name&#x22;: &#x22;tool-logger&#x22;,            &#x22;type&#x22;: &#x22;command&#x22;,            &#x22;command&#x22;: &#x22;$GEMINI_PROJECT_DIR/.gemini/hooks/log-tools.sh&#x22;,            &#x22;description&#x22;: &#x22;Log all tool executions&#x22;          }        ]      }    ]  }}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="step-3-test-your-hook">Step 3: Test your hook</h3><a class="sl-anchor-link" href="#step-3-test-your-hook"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œStep 3: Test your hookâ€</span></a></div>
<p>Run Gemini CLI and execute any command that uses tools:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">> Read the README.md file</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">[Agent uses read_file tool]</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">Logged: read_file</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="> Read the README.md file[Agent uses read_file tool]Logged: read_file"><div></div></button></div></figure></div>
<p>Check <code dir="auto">.gemini/tool-log.txt</code> to see the logged tool executions.</p>
<div class="sl-heading-wrapper level-h2"><h2 id="practical-examples">Practical examples</h2><a class="sl-anchor-link" href="#practical-examples"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œPractical examplesâ€</span></a></div>
<div class="sl-heading-wrapper level-h3"><h3 id="security-block-secrets-in-commits">Security: Block secrets in commits</h3><a class="sl-anchor-link" href="#security-block-secrets-in-commits"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œSecurity: Block secrets in commitsâ€</span></a></div>
<p>Prevent committing files containing API keys or passwords.</p>
<p><strong><code dir="auto">.gemini/hooks/block-secrets.sh</code>:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868">#!/usr/bin/env bash</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">input</span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929">$(</span><span style="--0:#BD9CFE;--1:#6F4CDE">cat</span><span style="--0:#E1DFDF;--1:#292929">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868"># Extract content being written</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">content</span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929">$(</span><span style="--0:#8DA8FF;--1:#3252B8">echo</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">"</span><span style="--0:#E1DFDF;--1:#292929">$input</span><span style="--0:#77D5A3;--1:#007847">"</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">|</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">jq</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">-r</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">'.tool_input.content // .tool_input.new_string // ""'</span><span style="--0:#E1DFDF;--1:#292929">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868"># Check for secrets</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">if</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">echo</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">"</span><span style="--0:#E1DFDF;--1:#292929">$content</span><span style="--0:#77D5A3;--1:#007847">"</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">|</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">grep</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">-qE</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">'api[_-]?key|password|secret'</span><span style="--0:#E1DFDF;--1:#292929">; </span><span style="--0:#FD8DA3;--1:#C12F57">then</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8DA8FF;--1:#3252B8">echo</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">'{"decision":"deny","reason":"Potential secret detected"}'</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">>&#x26;2</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8DA8FF;--1:#3252B8">exit</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">fi</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#8DA8FF;--1:#3252B8">exit</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">0</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env bashinput=$(cat)# Extract content being writtencontent=$(echo &#x22;$input&#x22; | jq -r &#x27;.tool_input.content // .tool_input.new_string // &#x22;&#x22;&#x27;)# Check for secretsif echo &#x22;$content&#x22; | grep -qE &#x27;api[_-]?key|password|secret&#x27;; then  echo &#x27;{&#x22;decision&#x22;:&#x22;deny&#x22;,&#x22;reason&#x22;:&#x22;Potential secret detected&#x22;}&#x27; >&#x26;2  exit 2fiexit 0"><div></div></button></div></figure></div>
<p><strong><code dir="auto">.gemini/settings.json</code>:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="json"><code><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85CDF1;--1:#00709A">"hooks"</span><span style="--0:#E1DFDF;--1:#292929">: {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85CDF1;--1:#00709A">"BeforeTool"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"matcher"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"write_file|replace"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"hooks"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"name"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"secret-scanner"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"type"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"command"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"command"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"$GEMINI_PROJECT_DIR/.gemini/hooks/block-secrets.sh"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"description"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"Prevent committing secrets"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{  &#x22;hooks&#x22;: {    &#x22;BeforeTool&#x22;: [      {        &#x22;matcher&#x22;: &#x22;write_file|replace&#x22;,        &#x22;hooks&#x22;: [          {            &#x22;name&#x22;: &#x22;secret-scanner&#x22;,            &#x22;type&#x22;: &#x22;command&#x22;,            &#x22;command&#x22;: &#x22;$GEMINI_PROJECT_DIR/.gemini/hooks/block-secrets.sh&#x22;,            &#x22;description&#x22;: &#x22;Prevent committing secrets&#x22;          }        ]      }    ]  }}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="auto-testing-after-code-changes">Auto-testing after code changes</h3><a class="sl-anchor-link" href="#auto-testing-after-code-changes"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œAuto-testing after code changesâ€</span></a></div>
<p>Automatically run tests when code files are modified.</p>
<p><strong><code dir="auto">.gemini/hooks/auto-test.sh</code>:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868">#!/usr/bin/env bash</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">input</span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929">$(</span><span style="--0:#BD9CFE;--1:#6F4CDE">cat</span><span style="--0:#E1DFDF;--1:#292929">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">file_path</span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929">$(</span><span style="--0:#8DA8FF;--1:#3252B8">echo</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">"</span><span style="--0:#E1DFDF;--1:#292929">$input</span><span style="--0:#77D5A3;--1:#007847">"</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">|</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">jq</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">-r</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">'.tool_input.file_path'</span><span style="--0:#E1DFDF;--1:#292929">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868"># Only test .ts files</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">if</span><span style="--0:#E1DFDF;--1:#292929"> [[ </span><span style="--0:#FD8DA3;--1:#C12F57">!</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">"</span><span style="--0:#E1DFDF;--1:#292929">$file_path</span><span style="--0:#77D5A3;--1:#007847">"</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=~</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">\.</span><span style="--0:#E1DFDF;--1:#292929">ts$ ]]; </span><span style="--0:#FD8DA3;--1:#C12F57">then</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8DA8FF;--1:#3252B8">exit</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">fi</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868"># Find corresponding test file</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">test_file</span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#77D5A3;--1:#007847">"${</span><span style="--0:#E1DFDF;--1:#292929">file_path</span><span style="--0:#FD8DA3;--1:#C12F57">%</span><span style="--0:#77D5A3;--1:#007847">.</span><span style="--0:#E1DFDF;--1:#292929">ts</span><span style="--0:#77D5A3;--1:#007847">}.test.ts"</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">if</span><span style="--0:#E1DFDF;--1:#292929"> [ </span><span style="--0:#FD8DA3;--1:#C12F57">!</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">-f</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">"</span><span style="--0:#E1DFDF;--1:#292929">$test_file</span><span style="--0:#77D5A3;--1:#007847">"</span><span style="--0:#E1DFDF;--1:#292929"> ]; </span><span style="--0:#FD8DA3;--1:#C12F57">then</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8DA8FF;--1:#3252B8">echo</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">"âš ï¸ No test file found"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8DA8FF;--1:#3252B8">exit</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">fi</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868"># Run tests</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">if</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">npx</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">vitest</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">run</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">"</span><span style="--0:#E1DFDF;--1:#292929">$test_file</span><span style="--0:#77D5A3;--1:#007847">"</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">--silent</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">2>&#x26;1</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">|</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">head</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">-20</span><span style="--0:#E1DFDF;--1:#292929">; </span><span style="--0:#FD8DA3;--1:#C12F57">then</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8DA8FF;--1:#3252B8">echo</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">"âœ… Tests passed"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">else</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8DA8FF;--1:#3252B8">echo</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">"âŒ Tests failed"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">fi</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#8DA8FF;--1:#3252B8">exit</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">0</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env bashinput=$(cat)file_path=$(echo &#x22;$input&#x22; | jq -r &#x27;.tool_input.file_path&#x27;)# Only test .ts filesif [[ ! &#x22;$file_path&#x22; =~ \.ts$ ]]; then  exit 0fi# Find corresponding test filetest_file=&#x22;${file_path%.ts}.test.ts&#x22;if [ ! -f &#x22;$test_file&#x22; ]; then  echo &#x22;âš ï¸ No test file found&#x22;  exit 0fi# Run testsif npx vitest run &#x22;$test_file&#x22; --silent 2>&#x26;1 | head -20; then  echo &#x22;âœ… Tests passed&#x22;else  echo &#x22;âŒ Tests failed&#x22;fiexit 0"><div></div></button></div></figure></div>
<p><strong><code dir="auto">.gemini/settings.json</code>:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="json"><code><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85CDF1;--1:#00709A">"hooks"</span><span style="--0:#E1DFDF;--1:#292929">: {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85CDF1;--1:#00709A">"AfterTool"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"matcher"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"write_file|replace"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"hooks"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"name"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"auto-test"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"type"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"command"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"command"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"$GEMINI_PROJECT_DIR/.gemini/hooks/auto-test.sh"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"description"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"Run tests after code changes"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{  &#x22;hooks&#x22;: {    &#x22;AfterTool&#x22;: [      {        &#x22;matcher&#x22;: &#x22;write_file|replace&#x22;,        &#x22;hooks&#x22;: [          {            &#x22;name&#x22;: &#x22;auto-test&#x22;,            &#x22;type&#x22;: &#x22;command&#x22;,            &#x22;command&#x22;: &#x22;$GEMINI_PROJECT_DIR/.gemini/hooks/auto-test.sh&#x22;,            &#x22;description&#x22;: &#x22;Run tests after code changes&#x22;          }        ]      }    ]  }}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="dynamic-context-injection">Dynamic context injection</h3><a class="sl-anchor-link" href="#dynamic-context-injection"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œDynamic context injectionâ€</span></a></div>
<p>Add relevant project context before each agent interaction.</p>
<p><strong><code dir="auto">.gemini/hooks/inject-context.sh</code>:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868">#!/usr/bin/env bash</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868"># Get recent git commits for context</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">context</span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929">$(</span><span style="--0:#BD9CFE;--1:#6F4CDE">git</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">log</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">-5</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">--oneline</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">2></span><span style="--0:#77D5A3;--1:#007847">/dev/null</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">||</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">echo</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">"No git history"</span><span style="--0:#E1DFDF;--1:#292929">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868"># Return as JSON</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD9CFE;--1:#6F4CDE">cat</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">&#x3C;&#x3C;</span><span style="--0:#77D5A3;--1:#007847">EOF</span></div></div><div class="ec-line"><div class="code"><span style="--0:#77D5A3;--1:#007847">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#77D5A3;--1:#007847">  </span></span><span style="--0:#77D5A3;--1:#007847">"hookSpecificOutput": {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#77D5A3;--1:#007847">    </span></span><span style="--0:#77D5A3;--1:#007847">"hookEventName": "BeforeAgent",</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#77D5A3;--1:#007847">    </span></span><span style="--0:#77D5A3;--1:#007847">"additionalContext": "Recent commits:\n</span><span style="--0:#E1DFDF;--1:#292929">$context</span><span style="--0:#77D5A3;--1:#007847">"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#77D5A3;--1:#007847">  </span></span><span style="--0:#77D5A3;--1:#007847">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#77D5A3;--1:#007847">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#77D5A3;--1:#007847">EOF</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env bash# Get recent git commits for contextcontext=$(git log -5 --oneline 2>/dev/null || echo &#x22;No git history&#x22;)# Return as JSONcat <<EOF{  &#x22;hookSpecificOutput&#x22;: {    &#x22;hookEventName&#x22;: &#x22;BeforeAgent&#x22;,    &#x22;additionalContext&#x22;: &#x22;Recent commits:\n$context&#x22;  }}EOF"><div></div></button></div></figure></div>
<p><strong><code dir="auto">.gemini/settings.json</code>:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="json"><code><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85CDF1;--1:#00709A">"hooks"</span><span style="--0:#E1DFDF;--1:#292929">: {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85CDF1;--1:#00709A">"BeforeAgent"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"matcher"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"*"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"hooks"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"name"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"git-context"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"type"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"command"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"command"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"$GEMINI_PROJECT_DIR/.gemini/hooks/inject-context.sh"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"description"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"Inject git commit history"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{  &#x22;hooks&#x22;: {    &#x22;BeforeAgent&#x22;: [      {        &#x22;matcher&#x22;: &#x22;*&#x22;,        &#x22;hooks&#x22;: [          {            &#x22;name&#x22;: &#x22;git-context&#x22;,            &#x22;type&#x22;: &#x22;command&#x22;,            &#x22;command&#x22;: &#x22;$GEMINI_PROJECT_DIR/.gemini/hooks/inject-context.sh&#x22;,            &#x22;description&#x22;: &#x22;Inject git commit history&#x22;          }        ]      }    ]  }}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h2"><h2 id="advanced-features">Advanced features</h2><a class="sl-anchor-link" href="#advanced-features"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œAdvanced featuresâ€</span></a></div>
<div class="sl-heading-wrapper level-h3"><h3 id="rag-based-tool-filtering">RAG-based tool filtering</h3><a class="sl-anchor-link" href="#rag-based-tool-filtering"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œRAG-based tool filteringâ€</span></a></div>
<p>Use <code dir="auto">BeforeToolSelection</code> to intelligently reduce the tool space based on the
current task. Instead of sending all 100+ tools to the model, filter to the most
relevant ~15 tools using semantic search or keyword matching.</p>
<p>This improves:</p>
<ul>
<li><strong>Model accuracy:</strong> Fewer similar tools reduce confusion</li>
<li><strong>Response speed:</strong> Smaller tool space is faster to process</li>
<li><strong>Cost efficiency:</strong> Less tokens used per request</li>
</ul>
<div class="sl-heading-wrapper level-h3"><h3 id="cross-session-memory">Cross-session memory</h3><a class="sl-anchor-link" href="#cross-session-memory"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œCross-session memoryâ€</span></a></div>
<p>Use <code dir="auto">SessionStart</code> and <code dir="auto">SessionEnd</code> hooks to maintain persistent knowledge
across sessions:</p>
<ul>
<li><strong>SessionStart:</strong> Load relevant memories from previous sessions</li>
<li><strong>AfterModel:</strong> Record important interactions during the session</li>
<li><strong>SessionEnd:</strong> Extract learnings and store for future use</li>
</ul>
<p>This enables the assistant to learn project conventions, remember important
decisions, and share knowledge across team members.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="hook-chaining">Hook chaining</h3><a class="sl-anchor-link" href="#hook-chaining"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œHook chainingâ€</span></a></div>
<p>Multiple hooks for the same event run in the order declared. Each hook can build
upon previous hooksâ€™ outputs:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="json"><code><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85CDF1;--1:#00709A">"hooks"</span><span style="--0:#E1DFDF;--1:#292929">: {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85CDF1;--1:#00709A">"BeforeAgent"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"matcher"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"*"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"hooks"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"name"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"load-memories"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"type"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"command"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"command"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"./hooks/load-memories.sh"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">},</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"name"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"analyze-sentiment"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"type"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"command"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"command"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"./hooks/analyze-sentiment.sh"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{  &#x22;hooks&#x22;: {    &#x22;BeforeAgent&#x22;: [      {        &#x22;matcher&#x22;: &#x22;*&#x22;,        &#x22;hooks&#x22;: [          {            &#x22;name&#x22;: &#x22;load-memories&#x22;,            &#x22;type&#x22;: &#x22;command&#x22;,            &#x22;command&#x22;: &#x22;./hooks/load-memories.sh&#x22;          },          {            &#x22;name&#x22;: &#x22;analyze-sentiment&#x22;,            &#x22;type&#x22;: &#x22;command&#x22;,            &#x22;command&#x22;: &#x22;./hooks/analyze-sentiment.sh&#x22;          }        ]      }    ]  }}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h2"><h2 id="complete-example-smart-development-workflow-assistant">Complete example: Smart Development Workflow Assistant</h2><a class="sl-anchor-link" href="#complete-example-smart-development-workflow-assistant"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œComplete example: Smart Development Workflow Assistantâ€</span></a></div>
<p>This comprehensive example demonstrates all hook events working together with
two advanced features:</p>
<ul>
<li><strong>RAG-based tool selection:</strong> Reduces 100+ tools to ~15 relevant ones per task</li>
<li><strong>Cross-session memory:</strong> Learns and persists project knowledge</li>
</ul>
<div class="sl-heading-wrapper level-h3"><h3 id="architecture">Architecture</h3><a class="sl-anchor-link" href="#architecture"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œArchitectureâ€</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">SessionStart â†’ Initialize memory &#x26; index tools</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1dfdf;--1:#292929">     </span></span><span style="--0:#e1dfdf;--1:#292929">â†“</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">BeforeAgent â†’ Inject relevant memories</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1dfdf;--1:#292929">     </span></span><span style="--0:#e1dfdf;--1:#292929">â†“</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">BeforeModel â†’ Add system instructions</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1dfdf;--1:#292929">     </span></span><span style="--0:#e1dfdf;--1:#292929">â†“</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">BeforeToolSelection â†’ Filter tools via RAG</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1dfdf;--1:#292929">     </span></span><span style="--0:#e1dfdf;--1:#292929">â†“</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">BeforeTool â†’ Validate security</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1dfdf;--1:#292929">     </span></span><span style="--0:#e1dfdf;--1:#292929">â†“</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">AfterTool â†’ Run auto-tests</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1dfdf;--1:#292929">     </span></span><span style="--0:#e1dfdf;--1:#292929">â†“</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">AfterModel â†’ Record interaction</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1dfdf;--1:#292929">     </span></span><span style="--0:#e1dfdf;--1:#292929">â†“</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">SessionEnd â†’ Extract and store memories</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SessionStart â†’ Initialize memory &#x26; index tools     â†“BeforeAgent â†’ Inject relevant memories     â†“BeforeModel â†’ Add system instructions     â†“BeforeToolSelection â†’ Filter tools via RAG     â†“BeforeTool â†’ Validate security     â†“AfterTool â†’ Run auto-tests     â†“AfterModel â†’ Record interaction     â†“SessionEnd â†’ Extract and store memories"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="installation">Installation</h3><a class="sl-anchor-link" href="#installation"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œInstallationâ€</span></a></div>
<p><strong>Prerequisites:</strong></p>
<ul>
<li>Node.js 18+</li>
<li>Gemini CLI installed</li>
</ul>
<p><strong>Setup:</strong></p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868"># Create hooks directory</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD9CFE;--1:#6F4CDE">mkdir</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">-p</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">.gemini/hooks</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">.gemini/memory</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868"># Install dependencies</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD9CFE;--1:#6F4CDE">npm</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">install</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">--save-dev</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">chromadb</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">@google/generative-ai</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868"># Copy hook scripts (shown below)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868"># Make them executable</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD9CFE;--1:#6F4CDE">chmod</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">+x</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">.gemini/hooks/</span><span style="--0:#8DA8FF;--1:#3252B8">*</span><span style="--0:#77D5A3;--1:#007847">.js</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="mkdir -p .gemini/hooks .gemini/memorynpm install --save-dev chromadb @google/generative-aichmod +x .gemini/hooks/*.js"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="configuration">Configuration</h3><a class="sl-anchor-link" href="#configuration"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œConfigurationâ€</span></a></div>
<p><strong><code dir="auto">.gemini/settings.json</code>:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="json"><code><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#85CDF1;--1:#00709A">"hooks"</span><span style="--0:#E1DFDF;--1:#292929">: {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85CDF1;--1:#00709A">"SessionStart"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"matcher"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"startup"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"hooks"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"name"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"init-assistant"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"type"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"command"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"command"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"node $GEMINI_PROJECT_DIR/.gemini/hooks/init.js"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"description"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"Initialize Smart Workflow Assistant"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">],</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85CDF1;--1:#00709A">"BeforeAgent"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"matcher"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"*"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"hooks"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"name"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"inject-memories"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"type"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"command"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"command"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"node $GEMINI_PROJECT_DIR/.gemini/hooks/inject-memories.js"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"description"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"Inject relevant project memories"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">],</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85CDF1;--1:#00709A">"BeforeToolSelection"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"matcher"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"*"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"hooks"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"name"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"rag-filter"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"type"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"command"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"command"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"node $GEMINI_PROJECT_DIR/.gemini/hooks/rag-filter.js"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"description"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"Filter tools using RAG"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">],</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85CDF1;--1:#00709A">"BeforeTool"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"matcher"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"write_file|replace"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"hooks"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"name"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"security-check"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"type"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"command"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"command"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"node $GEMINI_PROJECT_DIR/.gemini/hooks/security.js"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"description"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"Prevent committing secrets"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">],</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85CDF1;--1:#00709A">"AfterTool"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"matcher"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"write_file|replace"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"hooks"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"name"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"auto-test"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"type"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"command"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"command"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"node $GEMINI_PROJECT_DIR/.gemini/hooks/auto-test.js"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"description"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"Run tests after code changes"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">],</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85CDF1;--1:#00709A">"AfterModel"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"matcher"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"*"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"hooks"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"name"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"record-interaction"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"type"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"command"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"command"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"node $GEMINI_PROJECT_DIR/.gemini/hooks/record.js"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"description"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"Record interaction for learning"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">],</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#85CDF1;--1:#00709A">"SessionEnd"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"matcher"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"exit|logout"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#85CDF1;--1:#00709A">"hooks"</span><span style="--0:#E1DFDF;--1:#292929">: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"name"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"consolidate-memories"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"type"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"command"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"command"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"node $GEMINI_PROJECT_DIR/.gemini/hooks/consolidate.js"</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#85CDF1;--1:#00709A">"description"</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">"Extract and store session learnings"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{  &#x22;hooks&#x22;: {    &#x22;SessionStart&#x22;: [      {        &#x22;matcher&#x22;: &#x22;startup&#x22;,        &#x22;hooks&#x22;: [          {            &#x22;name&#x22;: &#x22;init-assistant&#x22;,            &#x22;type&#x22;: &#x22;command&#x22;,            &#x22;command&#x22;: &#x22;node $GEMINI_PROJECT_DIR/.gemini/hooks/init.js&#x22;,            &#x22;description&#x22;: &#x22;Initialize Smart Workflow Assistant&#x22;          }        ]      }    ],    &#x22;BeforeAgent&#x22;: [      {        &#x22;matcher&#x22;: &#x22;*&#x22;,        &#x22;hooks&#x22;: [          {            &#x22;name&#x22;: &#x22;inject-memories&#x22;,            &#x22;type&#x22;: &#x22;command&#x22;,            &#x22;command&#x22;: &#x22;node $GEMINI_PROJECT_DIR/.gemini/hooks/inject-memories.js&#x22;,            &#x22;description&#x22;: &#x22;Inject relevant project memories&#x22;          }        ]      }    ],    &#x22;BeforeToolSelection&#x22;: [      {        &#x22;matcher&#x22;: &#x22;*&#x22;,        &#x22;hooks&#x22;: [          {            &#x22;name&#x22;: &#x22;rag-filter&#x22;,            &#x22;type&#x22;: &#x22;command&#x22;,            &#x22;command&#x22;: &#x22;node $GEMINI_PROJECT_DIR/.gemini/hooks/rag-filter.js&#x22;,            &#x22;description&#x22;: &#x22;Filter tools using RAG&#x22;          }        ]      }    ],    &#x22;BeforeTool&#x22;: [      {        &#x22;matcher&#x22;: &#x22;write_file|replace&#x22;,        &#x22;hooks&#x22;: [          {            &#x22;name&#x22;: &#x22;security-check&#x22;,            &#x22;type&#x22;: &#x22;command&#x22;,            &#x22;command&#x22;: &#x22;node $GEMINI_PROJECT_DIR/.gemini/hooks/security.js&#x22;,            &#x22;description&#x22;: &#x22;Prevent committing secrets&#x22;          }        ]      }    ],    &#x22;AfterTool&#x22;: [      {        &#x22;matcher&#x22;: &#x22;write_file|replace&#x22;,        &#x22;hooks&#x22;: [          {            &#x22;name&#x22;: &#x22;auto-test&#x22;,            &#x22;type&#x22;: &#x22;command&#x22;,            &#x22;command&#x22;: &#x22;node $GEMINI_PROJECT_DIR/.gemini/hooks/auto-test.js&#x22;,            &#x22;description&#x22;: &#x22;Run tests after code changes&#x22;          }        ]      }    ],    &#x22;AfterModel&#x22;: [      {        &#x22;matcher&#x22;: &#x22;*&#x22;,        &#x22;hooks&#x22;: [          {            &#x22;name&#x22;: &#x22;record-interaction&#x22;,            &#x22;type&#x22;: &#x22;command&#x22;,            &#x22;command&#x22;: &#x22;node $GEMINI_PROJECT_DIR/.gemini/hooks/record.js&#x22;,            &#x22;description&#x22;: &#x22;Record interaction for learning&#x22;          }        ]      }    ],    &#x22;SessionEnd&#x22;: [      {        &#x22;matcher&#x22;: &#x22;exit|logout&#x22;,        &#x22;hooks&#x22;: [          {            &#x22;name&#x22;: &#x22;consolidate-memories&#x22;,            &#x22;type&#x22;: &#x22;command&#x22;,            &#x22;command&#x22;: &#x22;node $GEMINI_PROJECT_DIR/.gemini/hooks/consolidate.js&#x22;,            &#x22;description&#x22;: &#x22;Extract and store session learnings&#x22;          }        ]      }    ]  }}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="hook-scripts">Hook scripts</h3><a class="sl-anchor-link" href="#hook-scripts"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œHook scriptsâ€</span></a></div>
<div class="sl-heading-wrapper level-h4"><h4 id="1-initialize-sessionstart">1. Initialize (SessionStart)</h4><a class="sl-anchor-link" href="#1-initialize-sessionstart"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œ1. Initialize (SessionStart)â€</span></a></div>
<p><strong><code dir="auto">.gemini/hooks/init.js</code>:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="javascript"><code><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868">#!/usr/bin/env node</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> { </span><span style="--0:#8DA8FF;--1:#3252B8">ChromaClient</span><span style="--0:#E1DFDF;--1:#292929"> } </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">require</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'chromadb'</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">path</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">require</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'path'</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">fs</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">require</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'fs'</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">async</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">function</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">main</span><span style="--0:#E1DFDF;--1:#292929">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">projectDir</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> process.env.</span><span style="--0:#8DA8FF;--1:#3252B8">GEMINI_PROJECT_DIR</span><span style="--0:#E1DFDF;--1:#292929">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">chromaPath</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> path.</span><span style="--0:#BD9CFE;--1:#6F4CDE">join</span><span style="--0:#E1DFDF;--1:#292929">(projectDir, </span><span style="--0:#77D5A3;--1:#007847">'.gemini'</span><span style="--0:#E1DFDF;--1:#292929">, </span><span style="--0:#77D5A3;--1:#007847">'chroma'</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8E8E8E;--1:#686868">// Ensure chroma directory exists</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">fs.</span><span style="--0:#BD9CFE;--1:#6F4CDE">mkdirSync</span><span style="--0:#E1DFDF;--1:#292929">(chromaPath, { recursive: </span><span style="--0:#8DA8FF;--1:#3252B8">true</span><span style="--0:#E1DFDF;--1:#292929"> });</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">client</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">new</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">ChromaClient</span><span style="--0:#E1DFDF;--1:#292929">({ path: chromaPath });</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8E8E8E;--1:#686868">// Initialize memory collection</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">await</span><span style="--0:#E1DFDF;--1:#292929"> client.</span><span style="--0:#BD9CFE;--1:#6F4CDE">getOrCreateCollection</span><span style="--0:#E1DFDF;--1:#292929">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">name: </span><span style="--0:#77D5A3;--1:#007847">'project_memories'</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">metadata: { </span><span style="--0:#77D5A3;--1:#007847">'hnsw:space'</span><span style="--0:#E1DFDF;--1:#292929">: </span><span style="--0:#77D5A3;--1:#007847">'cosine'</span><span style="--0:#E1DFDF;--1:#292929"> },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8E8E8E;--1:#686868">// Count existing memories</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">collection</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">await</span><span style="--0:#E1DFDF;--1:#292929"> client.</span><span style="--0:#BD9CFE;--1:#6F4CDE">getCollection</span><span style="--0:#E1DFDF;--1:#292929">({ name: </span><span style="--0:#77D5A3;--1:#007847">'project_memories'</span><span style="--0:#E1DFDF;--1:#292929"> });</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">memoryCount</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">await</span><span style="--0:#E1DFDF;--1:#292929"> collection.</span><span style="--0:#BD9CFE;--1:#6F4CDE">count</span><span style="--0:#E1DFDF;--1:#292929">();</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">console.</span><span style="--0:#BD9CFE;--1:#6F4CDE">log</span><span style="--0:#E1DFDF;--1:#292929">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">stringify</span><span style="--0:#E1DFDF;--1:#292929">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">hookSpecificOutput: {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">hookEventName: </span><span style="--0:#77D5A3;--1:#007847">'SessionStart'</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">additionalContext: </span><span style="--0:#77D5A3;--1:#007847">`Smart Workflow Assistant initialized with ${</span><span style="--0:#E1DFDF;--1:#292929">memoryCount</span><span style="--0:#77D5A3;--1:#007847">} project memories.`</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">},</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">systemMessage: </span><span style="--0:#77D5A3;--1:#007847">`ðŸ§  ${</span><span style="--0:#E1DFDF;--1:#292929">memoryCount</span><span style="--0:#77D5A3;--1:#007847">} memories loaded`</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">}),</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">function</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">readStdin</span><span style="--0:#E1DFDF;--1:#292929">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">return</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">new</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">Promise</span><span style="--0:#E1DFDF;--1:#292929">((</span><span style="--0:#FFD395;--1:#99581C">resolve</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">chunks</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> [];</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">process.stdin.</span><span style="--0:#BD9CFE;--1:#6F4CDE">on</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'data'</span><span style="--0:#E1DFDF;--1:#292929">, (</span><span style="--0:#FFD395;--1:#99581C">chunk</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> chunks.</span><span style="--0:#BD9CFE;--1:#6F4CDE">push</span><span style="--0:#E1DFDF;--1:#292929">(chunk));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">process.stdin.</span><span style="--0:#BD9CFE;--1:#6F4CDE">on</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'end'</span><span style="--0:#E1DFDF;--1:#292929">, () </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">resolve</span><span style="--0:#E1DFDF;--1:#292929">(Buffer.</span><span style="--0:#BD9CFE;--1:#6F4CDE">concat</span><span style="--0:#E1DFDF;--1:#292929">(chunks).</span><span style="--0:#BD9CFE;--1:#6F4CDE">toString</span><span style="--0:#E1DFDF;--1:#292929">()));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">});</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#BD9CFE;--1:#6F4CDE">readStdin</span><span style="--0:#E1DFDF;--1:#292929">().</span><span style="--0:#BD9CFE;--1:#6F4CDE">then</span><span style="--0:#E1DFDF;--1:#292929">(main).</span><span style="--0:#BD9CFE;--1:#6F4CDE">catch</span><span style="--0:#E1DFDF;--1:#292929">(console.error);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env nodeconst { ChromaClient } = require(&#x27;chromadb&#x27;);const path = require(&#x27;path&#x27;);const fs = require(&#x27;fs&#x27;);async function main() {  const projectDir = process.env.GEMINI_PROJECT_DIR;  const chromaPath = path.join(projectDir, &#x27;.gemini&#x27;, &#x27;chroma&#x27;);  // Ensure chroma directory exists  fs.mkdirSync(chromaPath, { recursive: true });  const client = new ChromaClient({ path: chromaPath });  // Initialize memory collection  await client.getOrCreateCollection({    name: &#x27;project_memories&#x27;,    metadata: { &#x27;hnsw:space&#x27;: &#x27;cosine&#x27; },  });  // Count existing memories  const collection = await client.getCollection({ name: &#x27;project_memories&#x27; });  const memoryCount = await collection.count();  console.log(    JSON.stringify({      hookSpecificOutput: {        hookEventName: &#x27;SessionStart&#x27;,        additionalContext: &#x60;Smart Workflow Assistant initialized with ${memoryCount} project memories.&#x60;,      },      systemMessage: &#x60;ðŸ§  ${memoryCount} memories loaded&#x60;,    }),  );}function readStdin() {  return new Promise((resolve) => {    const chunks = [];    process.stdin.on(&#x27;data&#x27;, (chunk) => chunks.push(chunk));    process.stdin.on(&#x27;end&#x27;, () => resolve(Buffer.concat(chunks).toString()));  });}readStdin().then(main).catch(console.error);"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h4"><h4 id="2-inject-memories-beforeagent">2. Inject memories (BeforeAgent)</h4><a class="sl-anchor-link" href="#2-inject-memories-beforeagent"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œ2. Inject memories (BeforeAgent)â€</span></a></div>
<p><strong><code dir="auto">.gemini/hooks/inject-memories.js</code>:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="javascript"><code><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868">#!/usr/bin/env node</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> { </span><span style="--0:#8DA8FF;--1:#3252B8">GoogleGenerativeAI</span><span style="--0:#E1DFDF;--1:#292929"> } </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">require</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'@google/generative-ai'</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> { </span><span style="--0:#8DA8FF;--1:#3252B8">ChromaClient</span><span style="--0:#E1DFDF;--1:#292929"> } </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">require</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'chromadb'</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">path</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">require</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'path'</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">async</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">function</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">main</span><span style="--0:#E1DFDF;--1:#292929">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">input</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">parse</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#FD8DA3;--1:#C12F57">await</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">readStdin</span><span style="--0:#E1DFDF;--1:#292929">());</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> { </span><span style="--0:#8DA8FF;--1:#3252B8">prompt</span><span style="--0:#E1DFDF;--1:#292929"> } </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> input;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">if</span><span style="--0:#E1DFDF;--1:#292929"> (</span><span style="--0:#FD8DA3;--1:#C12F57">!</span><span style="--0:#E1DFDF;--1:#292929">prompt?.</span><span style="--0:#BD9CFE;--1:#6F4CDE">trim</span><span style="--0:#E1DFDF;--1:#292929">()) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">console.</span><span style="--0:#BD9CFE;--1:#6F4CDE">log</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">stringify</span><span style="--0:#E1DFDF;--1:#292929">({}));</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">return</span><span style="--0:#E1DFDF;--1:#292929">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8E8E8E;--1:#686868">// Embed the prompt</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">genai</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">new</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">GoogleGenerativeAI</span><span style="--0:#E1DFDF;--1:#292929">(process.env.</span><span style="--0:#8DA8FF;--1:#3252B8">GEMINI_API_KEY</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">model</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> genai.</span><span style="--0:#BD9CFE;--1:#6F4CDE">getGenerativeModel</span><span style="--0:#E1DFDF;--1:#292929">({ model: </span><span style="--0:#77D5A3;--1:#007847">'text-embedding-004'</span><span style="--0:#E1DFDF;--1:#292929"> });</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">result</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">await</span><span style="--0:#E1DFDF;--1:#292929"> model.</span><span style="--0:#BD9CFE;--1:#6F4CDE">embedContent</span><span style="--0:#E1DFDF;--1:#292929">(prompt);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8E8E8E;--1:#686868">// Search memories</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">projectDir</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> process.env.</span><span style="--0:#8DA8FF;--1:#3252B8">GEMINI_PROJECT_DIR</span><span style="--0:#E1DFDF;--1:#292929">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">client</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">new</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">ChromaClient</span><span style="--0:#E1DFDF;--1:#292929">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">path: path.</span><span style="--0:#BD9CFE;--1:#6F4CDE">join</span><span style="--0:#E1DFDF;--1:#292929">(projectDir, </span><span style="--0:#77D5A3;--1:#007847">'.gemini'</span><span style="--0:#E1DFDF;--1:#292929">, </span><span style="--0:#77D5A3;--1:#007847">'chroma'</span><span style="--0:#E1DFDF;--1:#292929">),</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">try</span><span style="--0:#E1DFDF;--1:#292929"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">collection</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">await</span><span style="--0:#E1DFDF;--1:#292929"> client.</span><span style="--0:#BD9CFE;--1:#6F4CDE">getCollection</span><span style="--0:#E1DFDF;--1:#292929">({ name: </span><span style="--0:#77D5A3;--1:#007847">'project_memories'</span><span style="--0:#E1DFDF;--1:#292929"> });</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">results</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">await</span><span style="--0:#E1DFDF;--1:#292929"> collection.</span><span style="--0:#BD9CFE;--1:#6F4CDE">query</span><span style="--0:#E1DFDF;--1:#292929">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">queryEmbeddings: [result.embedding.values],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">nResults: </span><span style="--0:#8DA8FF;--1:#3252B8">3</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">if</span><span style="--0:#E1DFDF;--1:#292929"> (results.documents[</span><span style="--0:#8DA8FF;--1:#3252B8">0</span><span style="--0:#E1DFDF;--1:#292929">]?.</span><span style="--0:#8DA8FF;--1:#3252B8">length</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">></span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">0</span><span style="--0:#E1DFDF;--1:#292929">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">memories</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> results.documents[</span><span style="--0:#8DA8FF;--1:#3252B8">0</span><span style="--0:#E1DFDF;--1:#292929">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">map</span><span style="--0:#E1DFDF;--1:#292929">((</span><span style="--0:#FFD395;--1:#99581C">doc</span><span style="--0:#E1DFDF;--1:#292929">, </span><span style="--0:#FFD395;--1:#99581C">i</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">meta</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> results.metadatas[</span><span style="--0:#8DA8FF;--1:#3252B8">0</span><span style="--0:#E1DFDF;--1:#292929">][i];</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#FD8DA3;--1:#C12F57">return</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">`- [${</span><span style="--0:#E1DFDF;--1:#292929">meta</span><span style="--0:#77D5A3;--1:#007847">.</span><span style="--0:#E1DFDF;--1:#292929">category</span><span style="--0:#77D5A3;--1:#007847">}] ${</span><span style="--0:#E1DFDF;--1:#292929">meta</span><span style="--0:#77D5A3;--1:#007847">.</span><span style="--0:#E1DFDF;--1:#292929">summary</span><span style="--0:#77D5A3;--1:#007847">}`</span><span style="--0:#E1DFDF;--1:#292929">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">})</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">join</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'</span><span style="--0:#8DA8FF;--1:#3252B8">\n</span><span style="--0:#77D5A3;--1:#007847">'</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">console.</span><span style="--0:#BD9CFE;--1:#6F4CDE">log</span><span style="--0:#E1DFDF;--1:#292929">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">stringify</span><span style="--0:#E1DFDF;--1:#292929">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">hookSpecificOutput: {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">            </span></span><span style="--0:#E1DFDF;--1:#292929">hookEventName: </span><span style="--0:#77D5A3;--1:#007847">'BeforeAgent'</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">            </span></span><span style="--0:#E1DFDF;--1:#292929">additionalContext: </span><span style="--0:#77D5A3;--1:#007847">`</span><span style="--0:#8DA8FF;--1:#3252B8">\n</span><span style="--0:#77D5A3;--1:#007847">## Relevant Project Context</span><span style="--0:#8DA8FF;--1:#3252B8">\n\n</span><span style="--0:#77D5A3;--1:#007847">${</span><span style="--0:#E1DFDF;--1:#292929">memories</span><span style="--0:#77D5A3;--1:#007847">}</span><span style="--0:#8DA8FF;--1:#3252B8">\n</span><span style="--0:#77D5A3;--1:#007847">`</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">},</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">systemMessage: </span><span style="--0:#77D5A3;--1:#007847">`ðŸ’­ ${</span><span style="--0:#E1DFDF;--1:#292929">results</span><span style="--0:#77D5A3;--1:#007847">.</span><span style="--0:#E1DFDF;--1:#292929">documents</span><span style="--0:#77D5A3;--1:#007847">[</span><span style="--0:#8DA8FF;--1:#3252B8">0</span><span style="--0:#77D5A3;--1:#007847">].</span><span style="--0:#8DA8FF;--1:#3252B8">length</span><span style="--0:#77D5A3;--1:#007847">} memories recalled`</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">}),</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">} </span><span style="--0:#FD8DA3;--1:#C12F57">else</span><span style="--0:#E1DFDF;--1:#292929"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">console.</span><span style="--0:#BD9CFE;--1:#6F4CDE">log</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">stringify</span><span style="--0:#E1DFDF;--1:#292929">({}));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">} </span><span style="--0:#FD8DA3;--1:#C12F57">catch</span><span style="--0:#E1DFDF;--1:#292929"> (error) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">console.</span><span style="--0:#BD9CFE;--1:#6F4CDE">log</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">stringify</span><span style="--0:#E1DFDF;--1:#292929">({}));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">function</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">readStdin</span><span style="--0:#E1DFDF;--1:#292929">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">return</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">new</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">Promise</span><span style="--0:#E1DFDF;--1:#292929">((</span><span style="--0:#FFD395;--1:#99581C">resolve</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">chunks</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> [];</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">process.stdin.</span><span style="--0:#BD9CFE;--1:#6F4CDE">on</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'data'</span><span style="--0:#E1DFDF;--1:#292929">, (</span><span style="--0:#FFD395;--1:#99581C">chunk</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> chunks.</span><span style="--0:#BD9CFE;--1:#6F4CDE">push</span><span style="--0:#E1DFDF;--1:#292929">(chunk));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">process.stdin.</span><span style="--0:#BD9CFE;--1:#6F4CDE">on</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'end'</span><span style="--0:#E1DFDF;--1:#292929">, () </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">resolve</span><span style="--0:#E1DFDF;--1:#292929">(Buffer.</span><span style="--0:#BD9CFE;--1:#6F4CDE">concat</span><span style="--0:#E1DFDF;--1:#292929">(chunks).</span><span style="--0:#BD9CFE;--1:#6F4CDE">toString</span><span style="--0:#E1DFDF;--1:#292929">()));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">});</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#BD9CFE;--1:#6F4CDE">readStdin</span><span style="--0:#E1DFDF;--1:#292929">().</span><span style="--0:#BD9CFE;--1:#6F4CDE">then</span><span style="--0:#E1DFDF;--1:#292929">(main).</span><span style="--0:#BD9CFE;--1:#6F4CDE">catch</span><span style="--0:#E1DFDF;--1:#292929">(console.error);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env nodeconst { GoogleGenerativeAI } = require(&#x27;@google/generative-ai&#x27;);const { ChromaClient } = require(&#x27;chromadb&#x27;);const path = require(&#x27;path&#x27;);async function main() {  const input = JSON.parse(await readStdin());  const { prompt } = input;  if (!prompt?.trim()) {    console.log(JSON.stringify({}));    return;  }  // Embed the prompt  const genai = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);  const model = genai.getGenerativeModel({ model: &#x27;text-embedding-004&#x27; });  const result = await model.embedContent(prompt);  // Search memories  const projectDir = process.env.GEMINI_PROJECT_DIR;  const client = new ChromaClient({    path: path.join(projectDir, &#x27;.gemini&#x27;, &#x27;chroma&#x27;),  });  try {    const collection = await client.getCollection({ name: &#x27;project_memories&#x27; });    const results = await collection.query({      queryEmbeddings: [result.embedding.values],      nResults: 3,    });    if (results.documents[0]?.length > 0) {      const memories = results.documents[0]        .map((doc, i) => {          const meta = results.metadatas[0][i];          return &#x60;- [${meta.category}] ${meta.summary}&#x60;;        })        .join(&#x27;\n&#x27;);      console.log(        JSON.stringify({          hookSpecificOutput: {            hookEventName: &#x27;BeforeAgent&#x27;,            additionalContext: &#x60;\n## Relevant Project Context\n\n${memories}\n&#x60;,          },          systemMessage: &#x60;ðŸ’­ ${results.documents[0].length} memories recalled&#x60;,        }),      );    } else {      console.log(JSON.stringify({}));    }  } catch (error) {    console.log(JSON.stringify({}));  }}function readStdin() {  return new Promise((resolve) => {    const chunks = [];    process.stdin.on(&#x27;data&#x27;, (chunk) => chunks.push(chunk));    process.stdin.on(&#x27;end&#x27;, () => resolve(Buffer.concat(chunks).toString()));  });}readStdin().then(main).catch(console.error);"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h4"><h4 id="3-rag-tool-filter-beforetoolselection">3. RAG tool filter (BeforeToolSelection)</h4><a class="sl-anchor-link" href="#3-rag-tool-filter-beforetoolselection"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œ3. RAG tool filter (BeforeToolSelection)â€</span></a></div>
<p><strong><code dir="auto">.gemini/hooks/rag-filter.js</code>:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="javascript"><code><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868">#!/usr/bin/env node</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> { </span><span style="--0:#8DA8FF;--1:#3252B8">GoogleGenerativeAI</span><span style="--0:#E1DFDF;--1:#292929"> } </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">require</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'@google/generative-ai'</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">async</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">function</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">main</span><span style="--0:#E1DFDF;--1:#292929">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">input</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">parse</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#FD8DA3;--1:#C12F57">await</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">readStdin</span><span style="--0:#E1DFDF;--1:#292929">());</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> { </span><span style="--0:#8DA8FF;--1:#3252B8">llm_request</span><span style="--0:#E1DFDF;--1:#292929"> } </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> input;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">candidateTools</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">llm_request.toolConfig?.functionCallingConfig?.allowedFunctionNames </span><span style="--0:#FD8DA3;--1:#C12F57">||</span><span style="--0:#E1DFDF;--1:#292929"> [];</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8E8E8E;--1:#686868">// Skip if already filtered</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">if</span><span style="--0:#E1DFDF;--1:#292929"> (candidateTools.</span><span style="--0:#8DA8FF;--1:#3252B8">length</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">&#x3C;=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">20</span><span style="--0:#E1DFDF;--1:#292929">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">console.</span><span style="--0:#BD9CFE;--1:#6F4CDE">log</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">stringify</span><span style="--0:#E1DFDF;--1:#292929">({}));</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">return</span><span style="--0:#E1DFDF;--1:#292929">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8E8E8E;--1:#686868">// Extract recent user messages</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">recentMessages</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> llm_request.messages</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">slice</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#FD8DA3;--1:#C12F57">-</span><span style="--0:#8DA8FF;--1:#3252B8">3</span><span style="--0:#E1DFDF;--1:#292929">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">filter</span><span style="--0:#E1DFDF;--1:#292929">((</span><span style="--0:#FFD395;--1:#99581C">m</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> m.role </span><span style="--0:#FD8DA3;--1:#C12F57">===</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">'user'</span><span style="--0:#E1DFDF;--1:#292929">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">map</span><span style="--0:#E1DFDF;--1:#292929">((</span><span style="--0:#FFD395;--1:#99581C">m</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> m.content)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">join</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'</span><span style="--0:#8DA8FF;--1:#3252B8">\n</span><span style="--0:#77D5A3;--1:#007847">'</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8E8E8E;--1:#686868">// Use fast model to extract task keywords</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">genai</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">new</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">GoogleGenerativeAI</span><span style="--0:#E1DFDF;--1:#292929">(process.env.</span><span style="--0:#8DA8FF;--1:#3252B8">GEMINI_API_KEY</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">model</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> genai.</span><span style="--0:#BD9CFE;--1:#6F4CDE">getGenerativeModel</span><span style="--0:#E1DFDF;--1:#292929">({ model: </span><span style="--0:#77D5A3;--1:#007847">'gemini-2.0-flash-exp'</span><span style="--0:#E1DFDF;--1:#292929"> });</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">result</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">await</span><span style="--0:#E1DFDF;--1:#292929"> model.</span><span style="--0:#BD9CFE;--1:#6F4CDE">generateContent</span><span style="--0:#E1DFDF;--1:#292929">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#77D5A3;--1:#007847">`Extract 3-5 keywords describing needed tool capabilities from this request:</span><span style="--0:#8DA8FF;--1:#3252B8">\n\n</span><span style="--0:#77D5A3;--1:#007847">${</span><span style="--0:#E1DFDF;--1:#292929">recentMessages</span><span style="--0:#77D5A3;--1:#007847">}</span><span style="--0:#8DA8FF;--1:#3252B8">\n\n</span><span style="--0:#77D5A3;--1:#007847">Keywords (comma-separated):`</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">keywords</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> result.response</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">text</span><span style="--0:#E1DFDF;--1:#292929">()</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">toLowerCase</span><span style="--0:#E1DFDF;--1:#292929">()</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">split</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">','</span><span style="--0:#E1DFDF;--1:#292929">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">map</span><span style="--0:#E1DFDF;--1:#292929">((</span><span style="--0:#FFD395;--1:#99581C">k</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> k.</span><span style="--0:#BD9CFE;--1:#6F4CDE">trim</span><span style="--0:#E1DFDF;--1:#292929">());</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8E8E8E;--1:#686868">// Simple keyword-based filtering + core tools</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">coreTools</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> [</span><span style="--0:#77D5A3;--1:#007847">'read_file'</span><span style="--0:#E1DFDF;--1:#292929">, </span><span style="--0:#77D5A3;--1:#007847">'write_file'</span><span style="--0:#E1DFDF;--1:#292929">, </span><span style="--0:#77D5A3;--1:#007847">'replace'</span><span style="--0:#E1DFDF;--1:#292929">, </span><span style="--0:#77D5A3;--1:#007847">'run_shell_command'</span><span style="--0:#E1DFDF;--1:#292929">];</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">filtered</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> candidateTools.</span><span style="--0:#BD9CFE;--1:#6F4CDE">filter</span><span style="--0:#E1DFDF;--1:#292929">((</span><span style="--0:#FFD395;--1:#99581C">tool</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">if</span><span style="--0:#E1DFDF;--1:#292929"> (coreTools.</span><span style="--0:#BD9CFE;--1:#6F4CDE">includes</span><span style="--0:#E1DFDF;--1:#292929">(tool)) </span><span style="--0:#FD8DA3;--1:#C12F57">return</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">true</span><span style="--0:#E1DFDF;--1:#292929">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">toolLower</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> tool.</span><span style="--0:#BD9CFE;--1:#6F4CDE">toLowerCase</span><span style="--0:#E1DFDF;--1:#292929">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">return</span><span style="--0:#E1DFDF;--1:#292929"> keywords.</span><span style="--0:#BD9CFE;--1:#6F4CDE">some</span><span style="--0:#E1DFDF;--1:#292929">(</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#FFD395;--1:#99581C">kw</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> toolLower.</span><span style="--0:#BD9CFE;--1:#6F4CDE">includes</span><span style="--0:#E1DFDF;--1:#292929">(kw) </span><span style="--0:#FD8DA3;--1:#C12F57">||</span><span style="--0:#E1DFDF;--1:#292929"> kw.</span><span style="--0:#BD9CFE;--1:#6F4CDE">includes</span><span style="--0:#E1DFDF;--1:#292929">(toolLower),</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">console.</span><span style="--0:#BD9CFE;--1:#6F4CDE">log</span><span style="--0:#E1DFDF;--1:#292929">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">stringify</span><span style="--0:#E1DFDF;--1:#292929">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">hookSpecificOutput: {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">hookEventName: </span><span style="--0:#77D5A3;--1:#007847">'BeforeToolSelection'</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">toolConfig: {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">functionCallingConfig: {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">            </span></span><span style="--0:#E1DFDF;--1:#292929">mode: </span><span style="--0:#77D5A3;--1:#007847">'ANY'</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">            </span></span><span style="--0:#E1DFDF;--1:#292929">allowedFunctionNames: filtered.</span><span style="--0:#BD9CFE;--1:#6F4CDE">slice</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#8DA8FF;--1:#3252B8">0</span><span style="--0:#E1DFDF;--1:#292929">, </span><span style="--0:#8DA8FF;--1:#3252B8">20</span><span style="--0:#E1DFDF;--1:#292929">),</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">},</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">},</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">},</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">systemMessage: </span><span style="--0:#77D5A3;--1:#007847">`ðŸŽ¯ Filtered ${</span><span style="--0:#E1DFDF;--1:#292929">candidateTools</span><span style="--0:#77D5A3;--1:#007847">.</span><span style="--0:#8DA8FF;--1:#3252B8">length</span><span style="--0:#77D5A3;--1:#007847">} â†’ ${</span><span style="--0:#E1DFDF;--1:#292929">Math</span><span style="--0:#77D5A3;--1:#007847">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">min</span><span style="--0:#77D5A3;--1:#007847">(</span><span style="--0:#E1DFDF;--1:#292929">filtered</span><span style="--0:#77D5A3;--1:#007847">.</span><span style="--0:#8DA8FF;--1:#3252B8">length</span><span style="--0:#77D5A3;--1:#007847">, </span><span style="--0:#8DA8FF;--1:#3252B8">20</span><span style="--0:#77D5A3;--1:#007847">)</span><span style="--0:#77D5A3;--1:#007847">} tools`</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">}),</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">function</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">readStdin</span><span style="--0:#E1DFDF;--1:#292929">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">return</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">new</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">Promise</span><span style="--0:#E1DFDF;--1:#292929">((</span><span style="--0:#FFD395;--1:#99581C">resolve</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">chunks</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> [];</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">process.stdin.</span><span style="--0:#BD9CFE;--1:#6F4CDE">on</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'data'</span><span style="--0:#E1DFDF;--1:#292929">, (</span><span style="--0:#FFD395;--1:#99581C">chunk</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> chunks.</span><span style="--0:#BD9CFE;--1:#6F4CDE">push</span><span style="--0:#E1DFDF;--1:#292929">(chunk));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">process.stdin.</span><span style="--0:#BD9CFE;--1:#6F4CDE">on</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'end'</span><span style="--0:#E1DFDF;--1:#292929">, () </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">resolve</span><span style="--0:#E1DFDF;--1:#292929">(Buffer.</span><span style="--0:#BD9CFE;--1:#6F4CDE">concat</span><span style="--0:#E1DFDF;--1:#292929">(chunks).</span><span style="--0:#BD9CFE;--1:#6F4CDE">toString</span><span style="--0:#E1DFDF;--1:#292929">()));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">});</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#BD9CFE;--1:#6F4CDE">readStdin</span><span style="--0:#E1DFDF;--1:#292929">().</span><span style="--0:#BD9CFE;--1:#6F4CDE">then</span><span style="--0:#E1DFDF;--1:#292929">(main).</span><span style="--0:#BD9CFE;--1:#6F4CDE">catch</span><span style="--0:#E1DFDF;--1:#292929">(console.error);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env nodeconst { GoogleGenerativeAI } = require(&#x27;@google/generative-ai&#x27;);async function main() {  const input = JSON.parse(await readStdin());  const { llm_request } = input;  const candidateTools =    llm_request.toolConfig?.functionCallingConfig?.allowedFunctionNames || [];  // Skip if already filtered  if (candidateTools.length <= 20) {    console.log(JSON.stringify({}));    return;  }  // Extract recent user messages  const recentMessages = llm_request.messages    .slice(-3)    .filter((m) => m.role === &#x27;user&#x27;)    .map((m) => m.content)    .join(&#x27;\n&#x27;);  // Use fast model to extract task keywords  const genai = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);  const model = genai.getGenerativeModel({ model: &#x27;gemini-2.0-flash-exp&#x27; });  const result = await model.generateContent(    &#x60;Extract 3-5 keywords describing needed tool capabilities from this request:\n\n${recentMessages}\n\nKeywords (comma-separated):&#x60;,  );  const keywords = result.response    .text()    .toLowerCase()    .split(&#x27;,&#x27;)    .map((k) => k.trim());  // Simple keyword-based filtering + core tools  const coreTools = [&#x27;read_file&#x27;, &#x27;write_file&#x27;, &#x27;replace&#x27;, &#x27;run_shell_command&#x27;];  const filtered = candidateTools.filter((tool) => {    if (coreTools.includes(tool)) return true;    const toolLower = tool.toLowerCase();    return keywords.some(      (kw) => toolLower.includes(kw) || kw.includes(toolLower),    );  });  console.log(    JSON.stringify({      hookSpecificOutput: {        hookEventName: &#x27;BeforeToolSelection&#x27;,        toolConfig: {          functionCallingConfig: {            mode: &#x27;ANY&#x27;,            allowedFunctionNames: filtered.slice(0, 20),          },        },      },      systemMessage: &#x60;ðŸŽ¯ Filtered ${candidateTools.length} â†’ ${Math.min(filtered.length, 20)} tools&#x60;,    }),  );}function readStdin() {  return new Promise((resolve) => {    const chunks = [];    process.stdin.on(&#x27;data&#x27;, (chunk) => chunks.push(chunk));    process.stdin.on(&#x27;end&#x27;, () => resolve(Buffer.concat(chunks).toString()));  });}readStdin().then(main).catch(console.error);"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h4"><h4 id="4-security-validation-beforetool">4. Security validation (BeforeTool)</h4><a class="sl-anchor-link" href="#4-security-validation-beforetool"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œ4. Security validation (BeforeTool)â€</span></a></div>
<p><strong><code dir="auto">.gemini/hooks/security.js</code>:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="javascript"><code><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868">#!/usr/bin/env node</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">SECRET_PATTERNS</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> [</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#77D5A3;--1:#007847">/api</span><span style="--0:#8DA8FF;--1:#3252B8">[_-]</span><span style="--0:#FD8DA3;--1:#C12F57">?</span><span style="--0:#77D5A3;--1:#007847">key</span><span style="--0:#8DA8FF;--1:#3252B8">\s</span><span style="--0:#FD8DA3;--1:#C12F57">*</span><span style="--0:#8DA8FF;--1:#3252B8">[:=]\s</span><span style="--0:#FD8DA3;--1:#C12F57">*</span><span style="--0:#8DA8FF;--1:#3252B8">['"]</span><span style="--0:#FD8DA3;--1:#C12F57">?</span><span style="--0:#8DA8FF;--1:#3252B8">[a-zA-Z0-9_-]</span><span style="--0:#FD8DA3;--1:#C12F57">{20,}</span><span style="--0:#8DA8FF;--1:#3252B8">['"]</span><span style="--0:#FD8DA3;--1:#C12F57">?</span><span style="--0:#77D5A3;--1:#007847">/</span><span style="--0:#FD8DA3;--1:#C12F57">i</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#77D5A3;--1:#007847">/password</span><span style="--0:#8DA8FF;--1:#3252B8">\s</span><span style="--0:#FD8DA3;--1:#C12F57">*</span><span style="--0:#8DA8FF;--1:#3252B8">[:=]\s</span><span style="--0:#FD8DA3;--1:#C12F57">*</span><span style="--0:#8DA8FF;--1:#3252B8">['"]</span><span style="--0:#FD8DA3;--1:#C12F57">?</span><span style="--0:#8DA8FF;--1:#3252B8">[</span><span style="--0:#FD8DA3;--1:#C12F57">^</span><span style="--0:#8DA8FF;--1:#3252B8">\s'"]</span><span style="--0:#FD8DA3;--1:#C12F57">{8,}</span><span style="--0:#8DA8FF;--1:#3252B8">['"]</span><span style="--0:#FD8DA3;--1:#C12F57">?</span><span style="--0:#77D5A3;--1:#007847">/</span><span style="--0:#FD8DA3;--1:#C12F57">i</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#77D5A3;--1:#007847">/secret</span><span style="--0:#8DA8FF;--1:#3252B8">\s</span><span style="--0:#FD8DA3;--1:#C12F57">*</span><span style="--0:#8DA8FF;--1:#3252B8">[:=]\s</span><span style="--0:#FD8DA3;--1:#C12F57">*</span><span style="--0:#8DA8FF;--1:#3252B8">['"]</span><span style="--0:#FD8DA3;--1:#C12F57">?</span><span style="--0:#8DA8FF;--1:#3252B8">[a-zA-Z0-9_-]</span><span style="--0:#FD8DA3;--1:#C12F57">{20,}</span><span style="--0:#8DA8FF;--1:#3252B8">['"]</span><span style="--0:#FD8DA3;--1:#C12F57">?</span><span style="--0:#77D5A3;--1:#007847">/</span><span style="--0:#FD8DA3;--1:#C12F57">i</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#77D5A3;--1:#007847">/AKIA</span><span style="--0:#8DA8FF;--1:#3252B8">[0-9A-Z]</span><span style="--0:#FD8DA3;--1:#C12F57">{16}</span><span style="--0:#77D5A3;--1:#007847">/</span><span style="--0:#E1DFDF;--1:#292929">, </span><span style="--0:#8E8E8E;--1:#686868">// AWS</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#77D5A3;--1:#007847">/ghp_</span><span style="--0:#8DA8FF;--1:#3252B8">[a-zA-Z0-9]</span><span style="--0:#FD8DA3;--1:#C12F57">{36}</span><span style="--0:#77D5A3;--1:#007847">/</span><span style="--0:#E1DFDF;--1:#292929">, </span><span style="--0:#8E8E8E;--1:#686868">// GitHub</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">];</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">async</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">function</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">main</span><span style="--0:#E1DFDF;--1:#292929">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">input</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">parse</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#FD8DA3;--1:#C12F57">await</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">readStdin</span><span style="--0:#E1DFDF;--1:#292929">());</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> { </span><span style="--0:#8DA8FF;--1:#3252B8">tool_input</span><span style="--0:#E1DFDF;--1:#292929"> } </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> input;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">content</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> tool_input.content </span><span style="--0:#FD8DA3;--1:#C12F57">||</span><span style="--0:#E1DFDF;--1:#292929"> tool_input.new_string </span><span style="--0:#FD8DA3;--1:#C12F57">||</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">''</span><span style="--0:#E1DFDF;--1:#292929">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">for</span><span style="--0:#E1DFDF;--1:#292929"> (</span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">pattern</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">of</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">SECRET_PATTERNS</span><span style="--0:#E1DFDF;--1:#292929">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">if</span><span style="--0:#E1DFDF;--1:#292929"> (pattern.</span><span style="--0:#BD9CFE;--1:#6F4CDE">test</span><span style="--0:#E1DFDF;--1:#292929">(content)) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">console.</span><span style="--0:#BD9CFE;--1:#6F4CDE">log</span><span style="--0:#E1DFDF;--1:#292929">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">stringify</span><span style="--0:#E1DFDF;--1:#292929">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">decision: </span><span style="--0:#77D5A3;--1:#007847">'deny'</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">reason:</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#77D5A3;--1:#007847">'Potential secret detected in code. Please remove sensitive data.'</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">systemMessage: </span><span style="--0:#77D5A3;--1:#007847">'ðŸš¨ Secret scanner blocked operation'</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">}),</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">process.</span><span style="--0:#BD9CFE;--1:#6F4CDE">exit</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#8DA8FF;--1:#3252B8">2</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">console.</span><span style="--0:#BD9CFE;--1:#6F4CDE">log</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">stringify</span><span style="--0:#E1DFDF;--1:#292929">({ decision: </span><span style="--0:#77D5A3;--1:#007847">'allow'</span><span style="--0:#E1DFDF;--1:#292929"> }));</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">function</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">readStdin</span><span style="--0:#E1DFDF;--1:#292929">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">return</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">new</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">Promise</span><span style="--0:#E1DFDF;--1:#292929">((</span><span style="--0:#FFD395;--1:#99581C">resolve</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">chunks</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> [];</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">process.stdin.</span><span style="--0:#BD9CFE;--1:#6F4CDE">on</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'data'</span><span style="--0:#E1DFDF;--1:#292929">, (</span><span style="--0:#FFD395;--1:#99581C">chunk</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> chunks.</span><span style="--0:#BD9CFE;--1:#6F4CDE">push</span><span style="--0:#E1DFDF;--1:#292929">(chunk));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">process.stdin.</span><span style="--0:#BD9CFE;--1:#6F4CDE">on</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'end'</span><span style="--0:#E1DFDF;--1:#292929">, () </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">resolve</span><span style="--0:#E1DFDF;--1:#292929">(Buffer.</span><span style="--0:#BD9CFE;--1:#6F4CDE">concat</span><span style="--0:#E1DFDF;--1:#292929">(chunks).</span><span style="--0:#BD9CFE;--1:#6F4CDE">toString</span><span style="--0:#E1DFDF;--1:#292929">()));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">});</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#BD9CFE;--1:#6F4CDE">readStdin</span><span style="--0:#E1DFDF;--1:#292929">().</span><span style="--0:#BD9CFE;--1:#6F4CDE">then</span><span style="--0:#E1DFDF;--1:#292929">(main).</span><span style="--0:#BD9CFE;--1:#6F4CDE">catch</span><span style="--0:#E1DFDF;--1:#292929">(console.error);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env nodeconst SECRET_PATTERNS = [  /api[_-]?key\s*[:=]\s*[&#x27;&#x22;]?[a-zA-Z0-9_-]{20,}[&#x27;&#x22;]?/i,  /password\s*[:=]\s*[&#x27;&#x22;]?[^\s&#x27;&#x22;]{8,}[&#x27;&#x22;]?/i,  /secret\s*[:=]\s*[&#x27;&#x22;]?[a-zA-Z0-9_-]{20,}[&#x27;&#x22;]?/i,  /AKIA[0-9A-Z]{16}/, // AWS  /ghp_[a-zA-Z0-9]{36}/, // GitHub];async function main() {  const input = JSON.parse(await readStdin());  const { tool_input } = input;  const content = tool_input.content || tool_input.new_string || &#x27;&#x27;;  for (const pattern of SECRET_PATTERNS) {    if (pattern.test(content)) {      console.log(        JSON.stringify({          decision: &#x27;deny&#x27;,          reason:            &#x27;Potential secret detected in code. Please remove sensitive data.&#x27;,          systemMessage: &#x27;ðŸš¨ Secret scanner blocked operation&#x27;,        }),      );      process.exit(2);    }  }  console.log(JSON.stringify({ decision: &#x27;allow&#x27; }));}function readStdin() {  return new Promise((resolve) => {    const chunks = [];    process.stdin.on(&#x27;data&#x27;, (chunk) => chunks.push(chunk));    process.stdin.on(&#x27;end&#x27;, () => resolve(Buffer.concat(chunks).toString()));  });}readStdin().then(main).catch(console.error);"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h4"><h4 id="5-auto-test-aftertool">5. Auto-test (AfterTool)</h4><a class="sl-anchor-link" href="#5-auto-test-aftertool"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œ5. Auto-test (AfterTool)â€</span></a></div>
<p><strong><code dir="auto">.gemini/hooks/auto-test.js</code>:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="javascript"><code><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868">#!/usr/bin/env node</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> { </span><span style="--0:#8DA8FF;--1:#3252B8">execSync</span><span style="--0:#E1DFDF;--1:#292929"> } </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">require</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'child_process'</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">fs</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">require</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'fs'</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">path</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">require</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'path'</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">async</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">function</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">main</span><span style="--0:#E1DFDF;--1:#292929">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">input</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">parse</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#FD8DA3;--1:#C12F57">await</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">readStdin</span><span style="--0:#E1DFDF;--1:#292929">());</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> { </span><span style="--0:#8DA8FF;--1:#3252B8">tool_input</span><span style="--0:#E1DFDF;--1:#292929"> } </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> input;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">filePath</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> tool_input.file_path;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">if</span><span style="--0:#E1DFDF;--1:#292929"> (</span><span style="--0:#FD8DA3;--1:#C12F57">!</span><span style="--0:#E1DFDF;--1:#292929">filePath?.</span><span style="--0:#BD9CFE;--1:#6F4CDE">match</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">/</span><span style="--0:#77D5A3;--0fw:bold;--1:#007847;--1fw:bold">\.</span><span style="--0:#77D5A3;--1:#007847">(ts</span><span style="--0:#FD8DA3;--1:#C12F57">|</span><span style="--0:#77D5A3;--1:#007847">js</span><span style="--0:#FD8DA3;--1:#C12F57">|</span><span style="--0:#77D5A3;--1:#007847">tsx</span><span style="--0:#FD8DA3;--1:#C12F57">|</span><span style="--0:#77D5A3;--1:#007847">jsx)</span><span style="--0:#FD8DA3;--1:#C12F57">$</span><span style="--0:#77D5A3;--1:#007847">/</span><span style="--0:#E1DFDF;--1:#292929">)) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">console.</span><span style="--0:#BD9CFE;--1:#6F4CDE">log</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">stringify</span><span style="--0:#E1DFDF;--1:#292929">({}));</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">return</span><span style="--0:#E1DFDF;--1:#292929">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8E8E8E;--1:#686868">// Find test file</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">ext</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> path.</span><span style="--0:#BD9CFE;--1:#6F4CDE">extname</span><span style="--0:#E1DFDF;--1:#292929">(filePath);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">base</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> filePath.</span><span style="--0:#BD9CFE;--1:#6F4CDE">slice</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#8DA8FF;--1:#3252B8">0</span><span style="--0:#E1DFDF;--1:#292929">, </span><span style="--0:#FD8DA3;--1:#C12F57">-</span><span style="--0:#E1DFDF;--1:#292929">ext.</span><span style="--0:#8DA8FF;--1:#3252B8">length</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">testFile</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">`${</span><span style="--0:#E1DFDF;--1:#292929">base</span><span style="--0:#77D5A3;--1:#007847">}.test${</span><span style="--0:#E1DFDF;--1:#292929">ext</span><span style="--0:#77D5A3;--1:#007847">}`</span><span style="--0:#E1DFDF;--1:#292929">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">if</span><span style="--0:#E1DFDF;--1:#292929"> (</span><span style="--0:#FD8DA3;--1:#C12F57">!</span><span style="--0:#E1DFDF;--1:#292929">fs.</span><span style="--0:#BD9CFE;--1:#6F4CDE">existsSync</span><span style="--0:#E1DFDF;--1:#292929">(testFile)) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">console.</span><span style="--0:#BD9CFE;--1:#6F4CDE">log</span><span style="--0:#E1DFDF;--1:#292929">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">stringify</span><span style="--0:#E1DFDF;--1:#292929">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">systemMessage: </span><span style="--0:#77D5A3;--1:#007847">`âš ï¸ No test file: ${</span><span style="--0:#E1DFDF;--1:#292929">path</span><span style="--0:#77D5A3;--1:#007847">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">basename</span><span style="--0:#77D5A3;--1:#007847">(</span><span style="--0:#E1DFDF;--1:#292929">testFile</span><span style="--0:#77D5A3;--1:#007847">)</span><span style="--0:#77D5A3;--1:#007847">}`</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">}),</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">return</span><span style="--0:#E1DFDF;--1:#292929">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8E8E8E;--1:#686868">// Run tests</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">try</span><span style="--0:#E1DFDF;--1:#292929"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#BD9CFE;--1:#6F4CDE">execSync</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">`npx vitest run ${</span><span style="--0:#E1DFDF;--1:#292929">testFile</span><span style="--0:#77D5A3;--1:#007847">} --silent`</span><span style="--0:#E1DFDF;--1:#292929">, {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">encoding: </span><span style="--0:#77D5A3;--1:#007847">'utf8'</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">stdio: </span><span style="--0:#77D5A3;--1:#007847">'pipe'</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">timeout: </span><span style="--0:#8DA8FF;--1:#3252B8">30000</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">console.</span><span style="--0:#BD9CFE;--1:#6F4CDE">log</span><span style="--0:#E1DFDF;--1:#292929">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">stringify</span><span style="--0:#E1DFDF;--1:#292929">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">systemMessage: </span><span style="--0:#77D5A3;--1:#007847">`âœ… Tests passed: ${</span><span style="--0:#E1DFDF;--1:#292929">path</span><span style="--0:#77D5A3;--1:#007847">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">basename</span><span style="--0:#77D5A3;--1:#007847">(</span><span style="--0:#E1DFDF;--1:#292929">filePath</span><span style="--0:#77D5A3;--1:#007847">)</span><span style="--0:#77D5A3;--1:#007847">}`</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">}),</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">} </span><span style="--0:#FD8DA3;--1:#C12F57">catch</span><span style="--0:#E1DFDF;--1:#292929"> (error) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">console.</span><span style="--0:#BD9CFE;--1:#6F4CDE">log</span><span style="--0:#E1DFDF;--1:#292929">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">stringify</span><span style="--0:#E1DFDF;--1:#292929">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">systemMessage: </span><span style="--0:#77D5A3;--1:#007847">`âŒ Tests failed: ${</span><span style="--0:#E1DFDF;--1:#292929">path</span><span style="--0:#77D5A3;--1:#007847">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">basename</span><span style="--0:#77D5A3;--1:#007847">(</span><span style="--0:#E1DFDF;--1:#292929">filePath</span><span style="--0:#77D5A3;--1:#007847">)</span><span style="--0:#77D5A3;--1:#007847">}`</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">}),</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">function</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">readStdin</span><span style="--0:#E1DFDF;--1:#292929">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">return</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">new</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">Promise</span><span style="--0:#E1DFDF;--1:#292929">((</span><span style="--0:#FFD395;--1:#99581C">resolve</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">chunks</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> [];</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">process.stdin.</span><span style="--0:#BD9CFE;--1:#6F4CDE">on</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'data'</span><span style="--0:#E1DFDF;--1:#292929">, (</span><span style="--0:#FFD395;--1:#99581C">chunk</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> chunks.</span><span style="--0:#BD9CFE;--1:#6F4CDE">push</span><span style="--0:#E1DFDF;--1:#292929">(chunk));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">process.stdin.</span><span style="--0:#BD9CFE;--1:#6F4CDE">on</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'end'</span><span style="--0:#E1DFDF;--1:#292929">, () </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">resolve</span><span style="--0:#E1DFDF;--1:#292929">(Buffer.</span><span style="--0:#BD9CFE;--1:#6F4CDE">concat</span><span style="--0:#E1DFDF;--1:#292929">(chunks).</span><span style="--0:#BD9CFE;--1:#6F4CDE">toString</span><span style="--0:#E1DFDF;--1:#292929">()));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">});</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#BD9CFE;--1:#6F4CDE">readStdin</span><span style="--0:#E1DFDF;--1:#292929">().</span><span style="--0:#BD9CFE;--1:#6F4CDE">then</span><span style="--0:#E1DFDF;--1:#292929">(main).</span><span style="--0:#BD9CFE;--1:#6F4CDE">catch</span><span style="--0:#E1DFDF;--1:#292929">(console.error);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env nodeconst { execSync } = require(&#x27;child_process&#x27;);const fs = require(&#x27;fs&#x27;);const path = require(&#x27;path&#x27;);async function main() {  const input = JSON.parse(await readStdin());  const { tool_input } = input;  const filePath = tool_input.file_path;  if (!filePath?.match(/\.(ts|js|tsx|jsx)$/)) {    console.log(JSON.stringify({}));    return;  }  // Find test file  const ext = path.extname(filePath);  const base = filePath.slice(0, -ext.length);  const testFile = &#x60;${base}.test${ext}&#x60;;  if (!fs.existsSync(testFile)) {    console.log(      JSON.stringify({        systemMessage: &#x60;âš ï¸ No test file: ${path.basename(testFile)}&#x60;,      }),    );    return;  }  // Run tests  try {    execSync(&#x60;npx vitest run ${testFile} --silent&#x60;, {      encoding: &#x27;utf8&#x27;,      stdio: &#x27;pipe&#x27;,      timeout: 30000,    });    console.log(      JSON.stringify({        systemMessage: &#x60;âœ… Tests passed: ${path.basename(filePath)}&#x60;,      }),    );  } catch (error) {    console.log(      JSON.stringify({        systemMessage: &#x60;âŒ Tests failed: ${path.basename(filePath)}&#x60;,      }),    );  }}function readStdin() {  return new Promise((resolve) => {    const chunks = [];    process.stdin.on(&#x27;data&#x27;, (chunk) => chunks.push(chunk));    process.stdin.on(&#x27;end&#x27;, () => resolve(Buffer.concat(chunks).toString()));  });}readStdin().then(main).catch(console.error);"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h4"><h4 id="6-record-interaction-aftermodel">6. Record interaction (AfterModel)</h4><a class="sl-anchor-link" href="#6-record-interaction-aftermodel"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œ6. Record interaction (AfterModel)â€</span></a></div>
<p><strong><code dir="auto">.gemini/hooks/record.js</code>:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="javascript"><code><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868">#!/usr/bin/env node</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">fs</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">require</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'fs'</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">path</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">require</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'path'</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">async</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">function</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">main</span><span style="--0:#E1DFDF;--1:#292929">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">input</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">parse</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#FD8DA3;--1:#C12F57">await</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">readStdin</span><span style="--0:#E1DFDF;--1:#292929">());</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> { </span><span style="--0:#8DA8FF;--1:#3252B8">llm_request</span><span style="--0:#E1DFDF;--1:#292929">, </span><span style="--0:#8DA8FF;--1:#3252B8">llm_response</span><span style="--0:#E1DFDF;--1:#292929"> } </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> input;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">projectDir</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> process.env.</span><span style="--0:#8DA8FF;--1:#3252B8">GEMINI_PROJECT_DIR</span><span style="--0:#E1DFDF;--1:#292929">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">sessionId</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> process.env.</span><span style="--0:#8DA8FF;--1:#3252B8">GEMINI_SESSION_ID</span><span style="--0:#E1DFDF;--1:#292929">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">tempFile</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> path.</span><span style="--0:#BD9CFE;--1:#6F4CDE">join</span><span style="--0:#E1DFDF;--1:#292929">(</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">projectDir,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#77D5A3;--1:#007847">'.gemini'</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#77D5A3;--1:#007847">'memory'</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#77D5A3;--1:#007847">`session-${</span><span style="--0:#E1DFDF;--1:#292929">sessionId</span><span style="--0:#77D5A3;--1:#007847">}.jsonl`</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">fs.</span><span style="--0:#BD9CFE;--1:#6F4CDE">mkdirSync</span><span style="--0:#E1DFDF;--1:#292929">(path.</span><span style="--0:#BD9CFE;--1:#6F4CDE">dirname</span><span style="--0:#E1DFDF;--1:#292929">(tempFile), { recursive: </span><span style="--0:#8DA8FF;--1:#3252B8">true</span><span style="--0:#E1DFDF;--1:#292929"> });</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8E8E8E;--1:#686868">// Extract user message and model response</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">userMsg</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> llm_request.messages</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">?.</span><span style="--0:#BD9CFE;--1:#6F4CDE">filter</span><span style="--0:#E1DFDF;--1:#292929">((</span><span style="--0:#FFD395;--1:#99581C">m</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> m.role </span><span style="--0:#FD8DA3;--1:#C12F57">===</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">'user'</span><span style="--0:#E1DFDF;--1:#292929">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">slice</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#FD8DA3;--1:#C12F57">-</span><span style="--0:#8DA8FF;--1:#3252B8">1</span><span style="--0:#E1DFDF;--1:#292929">)[</span><span style="--0:#8DA8FF;--1:#3252B8">0</span><span style="--0:#E1DFDF;--1:#292929">]?.content;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">modelMsg</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> llm_response.candidates?.[</span><span style="--0:#8DA8FF;--1:#3252B8">0</span><span style="--0:#E1DFDF;--1:#292929">]?.content?.parts</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">?.</span><span style="--0:#BD9CFE;--1:#6F4CDE">map</span><span style="--0:#E1DFDF;--1:#292929">((</span><span style="--0:#FFD395;--1:#99581C">p</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> p.text)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">filter</span><span style="--0:#E1DFDF;--1:#292929">(Boolean)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">join</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">''</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">if</span><span style="--0:#E1DFDF;--1:#292929"> (userMsg </span><span style="--0:#FD8DA3;--1:#C12F57">&#x26;&#x26;</span><span style="--0:#E1DFDF;--1:#292929"> modelMsg) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">interaction</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">timestamp: </span><span style="--0:#FD8DA3;--1:#C12F57">new</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">Date</span><span style="--0:#E1DFDF;--1:#292929">().</span><span style="--0:#BD9CFE;--1:#6F4CDE">toISOString</span><span style="--0:#E1DFDF;--1:#292929">(),</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">user: process.env.</span><span style="--0:#8DA8FF;--1:#3252B8">USER</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">||</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">'unknown'</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">request: userMsg.</span><span style="--0:#BD9CFE;--1:#6F4CDE">slice</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#8DA8FF;--1:#3252B8">0</span><span style="--0:#E1DFDF;--1:#292929">, </span><span style="--0:#8DA8FF;--1:#3252B8">500</span><span style="--0:#E1DFDF;--1:#292929">), </span><span style="--0:#8E8E8E;--1:#686868">// Truncate for storage</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">response: modelMsg.</span><span style="--0:#BD9CFE;--1:#6F4CDE">slice</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#8DA8FF;--1:#3252B8">0</span><span style="--0:#E1DFDF;--1:#292929">, </span><span style="--0:#8DA8FF;--1:#3252B8">500</span><span style="--0:#E1DFDF;--1:#292929">),</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">};</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">fs.</span><span style="--0:#BD9CFE;--1:#6F4CDE">appendFileSync</span><span style="--0:#E1DFDF;--1:#292929">(tempFile, </span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">stringify</span><span style="--0:#E1DFDF;--1:#292929">(interaction) </span><span style="--0:#FD8DA3;--1:#C12F57">+</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">'</span><span style="--0:#8DA8FF;--1:#3252B8">\n</span><span style="--0:#77D5A3;--1:#007847">'</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">console.</span><span style="--0:#BD9CFE;--1:#6F4CDE">log</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">stringify</span><span style="--0:#E1DFDF;--1:#292929">({}));</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">function</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">readStdin</span><span style="--0:#E1DFDF;--1:#292929">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">return</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">new</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">Promise</span><span style="--0:#E1DFDF;--1:#292929">((</span><span style="--0:#FFD395;--1:#99581C">resolve</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">chunks</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> [];</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">process.stdin.</span><span style="--0:#BD9CFE;--1:#6F4CDE">on</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'data'</span><span style="--0:#E1DFDF;--1:#292929">, (</span><span style="--0:#FFD395;--1:#99581C">chunk</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> chunks.</span><span style="--0:#BD9CFE;--1:#6F4CDE">push</span><span style="--0:#E1DFDF;--1:#292929">(chunk));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">process.stdin.</span><span style="--0:#BD9CFE;--1:#6F4CDE">on</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'end'</span><span style="--0:#E1DFDF;--1:#292929">, () </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">resolve</span><span style="--0:#E1DFDF;--1:#292929">(Buffer.</span><span style="--0:#BD9CFE;--1:#6F4CDE">concat</span><span style="--0:#E1DFDF;--1:#292929">(chunks).</span><span style="--0:#BD9CFE;--1:#6F4CDE">toString</span><span style="--0:#E1DFDF;--1:#292929">()));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">});</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#BD9CFE;--1:#6F4CDE">readStdin</span><span style="--0:#E1DFDF;--1:#292929">().</span><span style="--0:#BD9CFE;--1:#6F4CDE">then</span><span style="--0:#E1DFDF;--1:#292929">(main).</span><span style="--0:#BD9CFE;--1:#6F4CDE">catch</span><span style="--0:#E1DFDF;--1:#292929">(console.error);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env nodeconst fs = require(&#x27;fs&#x27;);const path = require(&#x27;path&#x27;);async function main() {  const input = JSON.parse(await readStdin());  const { llm_request, llm_response } = input;  const projectDir = process.env.GEMINI_PROJECT_DIR;  const sessionId = process.env.GEMINI_SESSION_ID;  const tempFile = path.join(    projectDir,    &#x27;.gemini&#x27;,    &#x27;memory&#x27;,    &#x60;session-${sessionId}.jsonl&#x60;,  );  fs.mkdirSync(path.dirname(tempFile), { recursive: true });  // Extract user message and model response  const userMsg = llm_request.messages    ?.filter((m) => m.role === &#x27;user&#x27;)    .slice(-1)[0]?.content;  const modelMsg = llm_response.candidates?.[0]?.content?.parts    ?.map((p) => p.text)    .filter(Boolean)    .join(&#x27;&#x27;);  if (userMsg &#x26;&#x26; modelMsg) {    const interaction = {      timestamp: new Date().toISOString(),      user: process.env.USER || &#x27;unknown&#x27;,      request: userMsg.slice(0, 500), // Truncate for storage      response: modelMsg.slice(0, 500),    };    fs.appendFileSync(tempFile, JSON.stringify(interaction) + &#x27;\n&#x27;);  }  console.log(JSON.stringify({}));}function readStdin() {  return new Promise((resolve) => {    const chunks = [];    process.stdin.on(&#x27;data&#x27;, (chunk) => chunks.push(chunk));    process.stdin.on(&#x27;end&#x27;, () => resolve(Buffer.concat(chunks).toString()));  });}readStdin().then(main).catch(console.error);"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h4"><h4 id="7-consolidate-memories-sessionend">7. Consolidate memories (SessionEnd)</h4><a class="sl-anchor-link" href="#7-consolidate-memories-sessionend"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œ7. Consolidate memories (SessionEnd)â€</span></a></div>
<p><strong><code dir="auto">.gemini/hooks/consolidate.js</code>:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="javascript"><code><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868">#!/usr/bin/env node</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">fs</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">require</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'fs'</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">path</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">require</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'path'</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> { </span><span style="--0:#8DA8FF;--1:#3252B8">GoogleGenerativeAI</span><span style="--0:#E1DFDF;--1:#292929"> } </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">require</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'@google/generative-ai'</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> { </span><span style="--0:#8DA8FF;--1:#3252B8">ChromaClient</span><span style="--0:#E1DFDF;--1:#292929"> } </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">require</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'chromadb'</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">async</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">function</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">main</span><span style="--0:#E1DFDF;--1:#292929">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">input</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">parse</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#FD8DA3;--1:#C12F57">await</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">readStdin</span><span style="--0:#E1DFDF;--1:#292929">());</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">projectDir</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> process.env.</span><span style="--0:#8DA8FF;--1:#3252B8">GEMINI_PROJECT_DIR</span><span style="--0:#E1DFDF;--1:#292929">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">sessionId</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> process.env.</span><span style="--0:#8DA8FF;--1:#3252B8">GEMINI_SESSION_ID</span><span style="--0:#E1DFDF;--1:#292929">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">tempFile</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> path.</span><span style="--0:#BD9CFE;--1:#6F4CDE">join</span><span style="--0:#E1DFDF;--1:#292929">(</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">projectDir,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#77D5A3;--1:#007847">'.gemini'</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#77D5A3;--1:#007847">'memory'</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#77D5A3;--1:#007847">`session-${</span><span style="--0:#E1DFDF;--1:#292929">sessionId</span><span style="--0:#77D5A3;--1:#007847">}.jsonl`</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">if</span><span style="--0:#E1DFDF;--1:#292929"> (</span><span style="--0:#FD8DA3;--1:#C12F57">!</span><span style="--0:#E1DFDF;--1:#292929">fs.</span><span style="--0:#BD9CFE;--1:#6F4CDE">existsSync</span><span style="--0:#E1DFDF;--1:#292929">(tempFile)) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">console.</span><span style="--0:#BD9CFE;--1:#6F4CDE">log</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">stringify</span><span style="--0:#E1DFDF;--1:#292929">({}));</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">return</span><span style="--0:#E1DFDF;--1:#292929">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8E8E8E;--1:#686868">// Read interactions</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">interactions</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> fs</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">readFileSync</span><span style="--0:#E1DFDF;--1:#292929">(tempFile, </span><span style="--0:#77D5A3;--1:#007847">'utf8'</span><span style="--0:#E1DFDF;--1:#292929">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">trim</span><span style="--0:#E1DFDF;--1:#292929">()</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">split</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'</span><span style="--0:#8DA8FF;--1:#3252B8">\n</span><span style="--0:#77D5A3;--1:#007847">'</span><span style="--0:#E1DFDF;--1:#292929">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">filter</span><span style="--0:#E1DFDF;--1:#292929">(Boolean)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">map</span><span style="--0:#E1DFDF;--1:#292929">((</span><span style="--0:#FFD395;--1:#99581C">line</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">parse</span><span style="--0:#E1DFDF;--1:#292929">(line));</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">if</span><span style="--0:#E1DFDF;--1:#292929"> (interactions.</span><span style="--0:#8DA8FF;--1:#3252B8">length</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">===</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">0</span><span style="--0:#E1DFDF;--1:#292929">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">fs.</span><span style="--0:#BD9CFE;--1:#6F4CDE">unlinkSync</span><span style="--0:#E1DFDF;--1:#292929">(tempFile);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">console.</span><span style="--0:#BD9CFE;--1:#6F4CDE">log</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">stringify</span><span style="--0:#E1DFDF;--1:#292929">({}));</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">return</span><span style="--0:#E1DFDF;--1:#292929">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8E8E8E;--1:#686868">// Extract memories using LLM</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">genai</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">new</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">GoogleGenerativeAI</span><span style="--0:#E1DFDF;--1:#292929">(process.env.</span><span style="--0:#8DA8FF;--1:#3252B8">GEMINI_API_KEY</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">model</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> genai.</span><span style="--0:#BD9CFE;--1:#6F4CDE">getGenerativeModel</span><span style="--0:#E1DFDF;--1:#292929">({ model: </span><span style="--0:#77D5A3;--1:#007847">'gemini-2.0-flash-exp'</span><span style="--0:#E1DFDF;--1:#292929"> });</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">prompt</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">`Extract important project learnings from this session.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#77D5A3;--1:#007847">Focus on: decisions, conventions, gotchas, patterns.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#77D5A3;--1:#007847">Return JSON array with: category, summary, keywords</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#77D5A3;--1:#007847">Session interactions:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#77D5A3;--1:#007847">${</span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#77D5A3;--1:#007847">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">stringify</span><span style="--0:#77D5A3;--1:#007847">(</span><span style="--0:#E1DFDF;--1:#292929">interactions</span><span style="--0:#77D5A3;--1:#007847">, </span><span style="--0:#8DA8FF;--1:#3252B8">null</span><span style="--0:#77D5A3;--1:#007847">, </span><span style="--0:#8DA8FF;--1:#3252B8">2</span><span style="--0:#77D5A3;--1:#007847">)</span><span style="--0:#77D5A3;--1:#007847">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#77D5A3;--1:#007847">JSON:`</span><span style="--0:#E1DFDF;--1:#292929">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">try</span><span style="--0:#E1DFDF;--1:#292929"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">result</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">await</span><span style="--0:#E1DFDF;--1:#292929"> model.</span><span style="--0:#BD9CFE;--1:#6F4CDE">generateContent</span><span style="--0:#E1DFDF;--1:#292929">(prompt);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">text</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> result.response.</span><span style="--0:#BD9CFE;--1:#6F4CDE">text</span><span style="--0:#E1DFDF;--1:#292929">().</span><span style="--0:#BD9CFE;--1:#6F4CDE">replace</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">/```json</span><span style="--0:#8DA8FF;--1:#3252B8">\n</span><span style="--0:#FD8DA3;--1:#C12F57">?|</span><span style="--0:#8DA8FF;--1:#3252B8">\n</span><span style="--0:#FD8DA3;--1:#C12F57">?</span><span style="--0:#77D5A3;--1:#007847">```/</span><span style="--0:#FD8DA3;--1:#C12F57">g</span><span style="--0:#E1DFDF;--1:#292929">, </span><span style="--0:#77D5A3;--1:#007847">''</span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">memories</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">parse</span><span style="--0:#E1DFDF;--1:#292929">(text);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#8E8E8E;--1:#686868">// Store in ChromaDB</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">client</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">new</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">ChromaClient</span><span style="--0:#E1DFDF;--1:#292929">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">path: path.</span><span style="--0:#BD9CFE;--1:#6F4CDE">join</span><span style="--0:#E1DFDF;--1:#292929">(projectDir, </span><span style="--0:#77D5A3;--1:#007847">'.gemini'</span><span style="--0:#E1DFDF;--1:#292929">, </span><span style="--0:#77D5A3;--1:#007847">'chroma'</span><span style="--0:#E1DFDF;--1:#292929">),</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">});</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">collection</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">await</span><span style="--0:#E1DFDF;--1:#292929"> client.</span><span style="--0:#BD9CFE;--1:#6F4CDE">getCollection</span><span style="--0:#E1DFDF;--1:#292929">({ name: </span><span style="--0:#77D5A3;--1:#007847">'project_memories'</span><span style="--0:#E1DFDF;--1:#292929"> });</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">embedModel</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> genai.</span><span style="--0:#BD9CFE;--1:#6F4CDE">getGenerativeModel</span><span style="--0:#E1DFDF;--1:#292929">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">model: </span><span style="--0:#77D5A3;--1:#007847">'text-embedding-004'</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">for</span><span style="--0:#E1DFDF;--1:#292929"> (</span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">memory</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">of</span><span style="--0:#E1DFDF;--1:#292929"> memories) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">memoryText</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">`${</span><span style="--0:#E1DFDF;--1:#292929">memory</span><span style="--0:#77D5A3;--1:#007847">.</span><span style="--0:#E1DFDF;--1:#292929">category</span><span style="--0:#77D5A3;--1:#007847">}: ${</span><span style="--0:#E1DFDF;--1:#292929">memory</span><span style="--0:#77D5A3;--1:#007847">.</span><span style="--0:#E1DFDF;--1:#292929">summary</span><span style="--0:#77D5A3;--1:#007847">}`</span><span style="--0:#E1DFDF;--1:#292929">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">embedding</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">await</span><span style="--0:#E1DFDF;--1:#292929"> embedModel.</span><span style="--0:#BD9CFE;--1:#6F4CDE">embedContent</span><span style="--0:#E1DFDF;--1:#292929">(memoryText);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">id</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">`${</span><span style="--0:#E1DFDF;--1:#292929">Date</span><span style="--0:#77D5A3;--1:#007847">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">now</span><span style="--0:#77D5A3;--1:#007847">()</span><span style="--0:#77D5A3;--1:#007847">}-${</span><span style="--0:#E1DFDF;--1:#292929">Math</span><span style="--0:#77D5A3;--1:#007847">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">random</span><span style="--0:#77D5A3;--1:#007847">().</span><span style="--0:#BD9CFE;--1:#6F4CDE">toString</span><span style="--0:#77D5A3;--1:#007847">(</span><span style="--0:#8DA8FF;--1:#3252B8">36</span><span style="--0:#77D5A3;--1:#007847">).</span><span style="--0:#BD9CFE;--1:#6F4CDE">slice</span><span style="--0:#77D5A3;--1:#007847">(</span><span style="--0:#8DA8FF;--1:#3252B8">2</span><span style="--0:#77D5A3;--1:#007847">)</span><span style="--0:#77D5A3;--1:#007847">}`</span><span style="--0:#E1DFDF;--1:#292929">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#FD8DA3;--1:#C12F57">await</span><span style="--0:#E1DFDF;--1:#292929"> collection.</span><span style="--0:#BD9CFE;--1:#6F4CDE">add</span><span style="--0:#E1DFDF;--1:#292929">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">ids: [id],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">embeddings: [embedding.embedding.values],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">documents: [memoryText],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">metadatas: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">            </span></span><span style="--0:#E1DFDF;--1:#292929">category: memory.category </span><span style="--0:#FD8DA3;--1:#C12F57">||</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#77D5A3;--1:#007847">'general'</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">            </span></span><span style="--0:#E1DFDF;--1:#292929">summary: memory.summary,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">            </span></span><span style="--0:#E1DFDF;--1:#292929">keywords: (memory.keywords </span><span style="--0:#FD8DA3;--1:#C12F57">||</span><span style="--0:#E1DFDF;--1:#292929"> []).</span><span style="--0:#BD9CFE;--1:#6F4CDE">join</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">','</span><span style="--0:#E1DFDF;--1:#292929">),</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">            </span></span><span style="--0:#E1DFDF;--1:#292929">timestamp: </span><span style="--0:#FD8DA3;--1:#C12F57">new</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">Date</span><span style="--0:#E1DFDF;--1:#292929">().</span><span style="--0:#BD9CFE;--1:#6F4CDE">toISOString</span><span style="--0:#E1DFDF;--1:#292929">(),</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">          </span></span><span style="--0:#E1DFDF;--1:#292929">},</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">});</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">fs.</span><span style="--0:#BD9CFE;--1:#6F4CDE">unlinkSync</span><span style="--0:#E1DFDF;--1:#292929">(tempFile);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">console.</span><span style="--0:#BD9CFE;--1:#6F4CDE">log</span><span style="--0:#E1DFDF;--1:#292929">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">stringify</span><span style="--0:#E1DFDF;--1:#292929">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">        </span></span><span style="--0:#E1DFDF;--1:#292929">systemMessage: </span><span style="--0:#77D5A3;--1:#007847">`ðŸ§  ${</span><span style="--0:#E1DFDF;--1:#292929">memories</span><span style="--0:#77D5A3;--1:#007847">.</span><span style="--0:#8DA8FF;--1:#3252B8">length</span><span style="--0:#77D5A3;--1:#007847">} new learnings saved for future sessions`</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">      </span></span><span style="--0:#E1DFDF;--1:#292929">}),</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">} </span><span style="--0:#FD8DA3;--1:#C12F57">catch</span><span style="--0:#E1DFDF;--1:#292929"> (error) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">console.</span><span style="--0:#BD9CFE;--1:#6F4CDE">error</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'Error consolidating memories:'</span><span style="--0:#E1DFDF;--1:#292929">, error);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">fs.</span><span style="--0:#BD9CFE;--1:#6F4CDE">unlinkSync</span><span style="--0:#E1DFDF;--1:#292929">(tempFile);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">console.</span><span style="--0:#BD9CFE;--1:#6F4CDE">log</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#8DA8FF;--1:#3252B8">JSON</span><span style="--0:#E1DFDF;--1:#292929">.</span><span style="--0:#BD9CFE;--1:#6F4CDE">stringify</span><span style="--0:#E1DFDF;--1:#292929">({}));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">function</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">readStdin</span><span style="--0:#E1DFDF;--1:#292929">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FD8DA3;--1:#C12F57">return</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">new</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">Promise</span><span style="--0:#E1DFDF;--1:#292929">((</span><span style="--0:#FFD395;--1:#99581C">resolve</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">chunks</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> [];</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">process.stdin.</span><span style="--0:#BD9CFE;--1:#6F4CDE">on</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'data'</span><span style="--0:#E1DFDF;--1:#292929">, (</span><span style="--0:#FFD395;--1:#99581C">chunk</span><span style="--0:#E1DFDF;--1:#292929">) </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> chunks.</span><span style="--0:#BD9CFE;--1:#6F4CDE">push</span><span style="--0:#E1DFDF;--1:#292929">(chunk));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">    </span></span><span style="--0:#E1DFDF;--1:#292929">process.stdin.</span><span style="--0:#BD9CFE;--1:#6F4CDE">on</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#77D5A3;--1:#007847">'end'</span><span style="--0:#E1DFDF;--1:#292929">, () </span><span style="--0:#FD8DA3;--1:#C12F57">=></span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#BD9CFE;--1:#6F4CDE">resolve</span><span style="--0:#E1DFDF;--1:#292929">(Buffer.</span><span style="--0:#BD9CFE;--1:#6F4CDE">concat</span><span style="--0:#E1DFDF;--1:#292929">(chunks).</span><span style="--0:#BD9CFE;--1:#6F4CDE">toString</span><span style="--0:#E1DFDF;--1:#292929">()));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">});</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#BD9CFE;--1:#6F4CDE">readStdin</span><span style="--0:#E1DFDF;--1:#292929">().</span><span style="--0:#BD9CFE;--1:#6F4CDE">then</span><span style="--0:#E1DFDF;--1:#292929">(main).</span><span style="--0:#BD9CFE;--1:#6F4CDE">catch</span><span style="--0:#E1DFDF;--1:#292929">(console.error);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env nodeconst fs = require(&#x27;fs&#x27;);const path = require(&#x27;path&#x27;);const { GoogleGenerativeAI } = require(&#x27;@google/generative-ai&#x27;);const { ChromaClient } = require(&#x27;chromadb&#x27;);async function main() {  const input = JSON.parse(await readStdin());  const projectDir = process.env.GEMINI_PROJECT_DIR;  const sessionId = process.env.GEMINI_SESSION_ID;  const tempFile = path.join(    projectDir,    &#x27;.gemini&#x27;,    &#x27;memory&#x27;,    &#x60;session-${sessionId}.jsonl&#x60;,  );  if (!fs.existsSync(tempFile)) {    console.log(JSON.stringify({}));    return;  }  // Read interactions  const interactions = fs    .readFileSync(tempFile, &#x27;utf8&#x27;)    .trim()    .split(&#x27;\n&#x27;)    .filter(Boolean)    .map((line) => JSON.parse(line));  if (interactions.length === 0) {    fs.unlinkSync(tempFile);    console.log(JSON.stringify({}));    return;  }  // Extract memories using LLM  const genai = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);  const model = genai.getGenerativeModel({ model: &#x27;gemini-2.0-flash-exp&#x27; });  const prompt = &#x60;Extract important project learnings from this session.Focus on: decisions, conventions, gotchas, patterns.Return JSON array with: category, summary, keywordsSession interactions:${JSON.stringify(interactions, null, 2)}JSON:&#x60;;  try {    const result = await model.generateContent(prompt);    const text = result.response.text().replace(/&#x60;&#x60;&#x60;json\n?|\n?&#x60;&#x60;&#x60;/g, &#x27;&#x27;);    const memories = JSON.parse(text);    // Store in ChromaDB    const client = new ChromaClient({      path: path.join(projectDir, &#x27;.gemini&#x27;, &#x27;chroma&#x27;),    });    const collection = await client.getCollection({ name: &#x27;project_memories&#x27; });    const embedModel = genai.getGenerativeModel({      model: &#x27;text-embedding-004&#x27;,    });    for (const memory of memories) {      const memoryText = &#x60;${memory.category}: ${memory.summary}&#x60;;      const embedding = await embedModel.embedContent(memoryText);      const id = &#x60;${Date.now()}-${Math.random().toString(36).slice(2)}&#x60;;      await collection.add({        ids: [id],        embeddings: [embedding.embedding.values],        documents: [memoryText],        metadatas: [          {            category: memory.category || &#x27;general&#x27;,            summary: memory.summary,            keywords: (memory.keywords || []).join(&#x27;,&#x27;),            timestamp: new Date().toISOString(),          },        ],      });    }    fs.unlinkSync(tempFile);    console.log(      JSON.stringify({        systemMessage: &#x60;ðŸ§  ${memories.length} new learnings saved for future sessions&#x60;,      }),    );  } catch (error) {    console.error(&#x27;Error consolidating memories:&#x27;, error);    fs.unlinkSync(tempFile);    console.log(JSON.stringify({}));  }}function readStdin() {  return new Promise((resolve) => {    const chunks = [];    process.stdin.on(&#x27;data&#x27;, (chunk) => chunks.push(chunk));    process.stdin.on(&#x27;end&#x27;, () => resolve(Buffer.concat(chunks).toString()));  });}readStdin().then(main).catch(console.error);"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="example-session">Example session</h3><a class="sl-anchor-link" href="#example-session"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œExample sessionâ€</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">> gemini</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">ðŸ§  3 memories loaded</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">> Fix the authentication bug in login.ts</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">ðŸ’­ 2 memories recalled:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1dfdf;--1:#292929">  </span></span><span style="--0:#e1dfdf;--1:#292929">- [convention] Use middleware pattern for auth</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1dfdf;--1:#292929">  </span></span><span style="--0:#e1dfdf;--1:#292929">- [gotcha] Remember to update token types</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">ðŸŽ¯ Filtered 127 â†’ 15 tools</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">[Agent reads login.ts and proposes fix]</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">âœ… Tests passed: login.ts</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">---</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">> Add error logging to API endpoints</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">ðŸ’­ 3 memories recalled:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1dfdf;--1:#292929">  </span></span><span style="--0:#e1dfdf;--1:#292929">- [convention] Use middleware pattern for auth</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1dfdf;--1:#292929">  </span></span><span style="--0:#e1dfdf;--1:#292929">- [pattern] Centralized error handling in middleware</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1dfdf;--1:#292929">  </span></span><span style="--0:#e1dfdf;--1:#292929">- [decision] Log errors to CloudWatch</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">ðŸŽ¯ Filtered 127 â†’ 18 tools</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">[Agent implements error logging]</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">> /exit</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1dfdf;--1:#292929">ðŸ§  2 new learnings saved for future sessions</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="> geminiðŸ§  3 memories loaded> Fix the authentication bug in login.tsðŸ’­ 2 memories recalled:  - [convention] Use middleware pattern for auth  - [gotcha] Remember to update token typesðŸŽ¯ Filtered 127 â†’ 15 tools[Agent reads login.ts and proposes fix]âœ… Tests passed: login.ts---> Add error logging to API endpointsðŸ’­ 3 memories recalled:  - [convention] Use middleware pattern for auth  - [pattern] Centralized error handling in middleware  - [decision] Log errors to CloudWatchðŸŽ¯ Filtered 127 â†’ 18 tools[Agent implements error logging]> /exitðŸ§  2 new learnings saved for future sessions"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="what-makes-this-example-special">What makes this example special</h3><a class="sl-anchor-link" href="#what-makes-this-example-special"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œWhat makes this example specialâ€</span></a></div>
<p><strong>RAG-based tool selection:</strong></p>
<ul>
<li>Traditional: Send all 100+ tools causing confusion and context overflow</li>
<li>This example: Extract intent, filter to ~15 relevant tools</li>
<li>Benefits: Faster responses, better selection, lower costs</li>
</ul>
<p><strong>Cross-session memory:</strong></p>
<ul>
<li>Traditional: Each session starts fresh</li>
<li>This example: Learns conventions, decisions, gotchas, patterns</li>
<li>Benefits: Shared knowledge across team members, persistent learnings</li>
</ul>
<p><strong>All hook events integrated:</strong></p>
<p>Demonstrates every hook event with practical use cases in a cohesive workflow.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="cost-efficiency">Cost efficiency</h3><a class="sl-anchor-link" href="#cost-efficiency"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œCost efficiencyâ€</span></a></div>
<ul>
<li>Uses <code dir="auto">gemini-2.0-flash-exp</code> for intent extraction (fast, cheap)</li>
<li>Uses <code dir="auto">text-embedding-004</code> for RAG (inexpensive)</li>
<li>Caches tool descriptions (one-time cost)</li>
<li>Minimal overhead per request (&#x3C;500ms typically)</li>
</ul>
<div class="sl-heading-wrapper level-h3"><h3 id="customization">Customization</h3><a class="sl-anchor-link" href="#customization"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œCustomizationâ€</span></a></div>
<p><strong>Adjust memory relevance:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="javascript"><code><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868">// In inject-memories.js, change nResults</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">results</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">await</span><span style="--0:#E1DFDF;--1:#292929"> collection.</span><span style="--0:#BD9CFE;--1:#6F4CDE">query</span><span style="--0:#E1DFDF;--1:#292929">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">queryEmbeddings: [result.embedding.values],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1DFDF;--1:#292929">  </span></span><span style="--0:#E1DFDF;--1:#292929">nResults: </span><span style="--0:#8DA8FF;--1:#3252B8">5</span><span style="--0:#E1DFDF;--1:#292929">, </span><span style="--0:#8E8E8E;--1:#686868">// More memories</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">});</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// In inject-memories.js, change nResultsconst results = await collection.query({  queryEmbeddings: [result.embedding.values],  nResults: 5, // More memories});"><div></div></button></div></figure></div>
<p><strong>Modify tool filter count:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="javascript"><code><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868">// In rag-filter.js, adjust the limit</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD9CFE;--1:#6F4CDE">allowedFunctionNames</span><span style="--0:#E1DFDF;--1:#292929">: filtered.</span><span style="--0:#BD9CFE;--1:#6F4CDE">slice</span><span style="--0:#E1DFDF;--1:#292929">(</span><span style="--0:#8DA8FF;--1:#3252B8">0</span><span style="--0:#E1DFDF;--1:#292929">, </span><span style="--0:#8DA8FF;--1:#3252B8">30</span><span style="--0:#E1DFDF;--1:#292929">), </span><span style="--0:#8E8E8E;--1:#686868">// More tools</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// In rag-filter.js, adjust the limitallowedFunctionNames: filtered.slice(0, 30), // More tools"><div></div></button></div></figure></div>
<p><strong>Add custom security patterns:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="javascript"><code><div class="ec-line"><div class="code"><span style="--0:#8E8E8E;--1:#686868">// In security.js, add patterns</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FD8DA3;--1:#C12F57">const</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#8DA8FF;--1:#3252B8">SECRET_PATTERNS</span><span style="--0:#E1DFDF;--1:#292929"> </span><span style="--0:#FD8DA3;--1:#C12F57">=</span><span style="--0:#E1DFDF;--1:#292929"> [</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8E8E8E;--1:#686868">// ... existing patterns</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#77D5A3;--1:#007847">/private</span><span style="--0:#8DA8FF;--1:#3252B8">[_-]</span><span style="--0:#FD8DA3;--1:#C12F57">?</span><span style="--0:#77D5A3;--1:#007847">key/</span><span style="--0:#FD8DA3;--1:#C12F57">i</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#77D5A3;--1:#007847">/auth</span><span style="--0:#8DA8FF;--1:#3252B8">[_-]</span><span style="--0:#FD8DA3;--1:#C12F57">?</span><span style="--0:#77D5A3;--1:#007847">token/</span><span style="--0:#FD8DA3;--1:#C12F57">i</span><span style="--0:#E1DFDF;--1:#292929">,</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1DFDF;--1:#292929">];</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// In security.js, add patternsconst SECRET_PATTERNS = [  // ... existing patterns  /private[_-]?key/i,  /auth[_-]?token/i,];"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h2"><h2 id="learn-more">Learn more</h2><a class="sl-anchor-link" href="#learn-more"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œLearn moreâ€</span></a></div>
<ul>
<li><a href="/docs/hooks">Hooks Reference</a> - Complete API reference and configuration</li>
<li><a href="/docs/hooks/best-practices">Best Practices</a> - Security, performance, and debugging</li>
<li><a href="/docs/cli/configuration">Configuration</a> - Gemini CLI settings</li>
<li><a href="/docs/cli/custom-commands">Custom Commands</a> - Create custom commands</li>
</ul> </div>  </div> </div>   </main> </div> </div>   </div> <div id="cookie-notice-wrapper" class="hidden astro-uz2wdcl7"> <div class="cookie-notice-container fixed bottom-0 left-0 right-0 flex justify-center z-50 astro-uz2wdcl7"> <div class="cookie-notice text-sm dark:bg-black/50 bg-white/50 backdrop-blur-sm m-2 p-3 rounded-lg flex max-sm:flex-col items-center border border-black/20 astro-uz2wdcl7"> <div class="mr-2 astro-uz2wdcl7">
This website uses <a href="https://policies.google.com/technologies/cookies" class="underline text-black/70 dark:text-white/70 astro-uz2wdcl7" target="_blank">cookies</a> from Google to deliver and enhance the quality of its services and to analyze
        traffic.
</div> <button id="cookie-ack-button" class="font-bold text-nowrap px-2 py-1 border rounded dark:bg-black/80 dark:text-white/70 dark:border-white/30 border-black/20 astro-uz2wdcl7">
I understand.
</button> </div> </div> </div> <script type="module">const e=document.getElementById("cookie-notice-wrapper"),t="__cookieAck";e&&localStorage.getItem(t)!=="true"&&e.classList.remove("hidden");const o=document.getElementById("cookie-ack-button");o?.addEventListener("click",()=>{localStorage.setItem(t,"true"),e&&(e.style.display="none")});</script>  <!-- Footer at bottom of .page flex container --> <footer class="site-footer astro-yriad4ts theme-aware astro-sz7xmlte"> <div class="footer-content astro-sz7xmlte"> <div class="logos astro-sz7xmlte"> <img class="logo-light astro-sz7xmlte" src="/assets/Google.svg" alt="Google logo" width="64.216" height="21"> <img class="logo-dark astro-sz7xmlte" src="/assets/Google-dark.svg" alt="Google logo" width="64.216" height="21"> <img class="logo-light fordev-logo astro-sz7xmlte" src="/assets/fordevelopers.svg" alt="For Developers logo" width="122.678" height="17.583"> <img class="logo-dark fordev-logo astro-sz7xmlte" src="/assets/fordevelopers-dark.svg" alt="For Developers logo" width="122.678" height="17.583"> </div> <div class="footer-links astro-sz7xmlte"> <a href="/terms" class="tos-link astro-sz7xmlte" target="_blank" rel="noopener noreferrer">Terms</a> <span class="divider astro-sz7xmlte">|</span> <a href="https://policies.google.com/privacy" class="tos-link astro-sz7xmlte" target="_blank" rel="noopener noreferrer">Privacy</a> </div> </div> </footer>  </div>  </body></html>